<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î∏îÎ°úÍ∑∏ ÏûêÎèô ÏûëÏÑ±Í∏∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 1.25em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .login-area {
            position: absolute;
            top: 20px;
            right: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .settings-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            margin-right: 10px;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: rotate(90deg);
        }

        .login-btn, .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .login-btn:hover, .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .user-info {
            color: white;
            font-size: 14px;
            opacity: 0.9;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            width: 100%;
            margin-bottom: 20px;
        }

        .header-nav {
            position: absolute;
            top: 20px;
            left: 30px;
        }

        .keyword-discovery-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .keyword-discovery-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .keyword-discovery-btn:active {
            transform: translateY(0);
        }

        /* ÌÇ§ÏõåÎìúÎ∞úÍµ¥ ÌôîÎ©¥ Ïä§ÌÉÄÏùº */
        .keyword-discovery-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 1000;
            overflow-y: auto;
        }

        .keyword-discovery-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .keyword-discovery-header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            position: relative;
        }

        .back-btn {
            position: absolute;
            left: 0;
            top: 0;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .keyword-discovery-header h1 {
            font-size: 2.5em;
            margin: 20px 0 10px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .keyword-discovery-header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .keyword-discovery-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }

        .new-keyword-section {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }
        
        .new-keyword-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .new-keyword-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
            background: linear-gradient(135deg, #ff5252 0%, #ff3742 100%);
        }
        
        .new-keyword-btn:active {
            transform: translateY(-1px);
        }
        
        .new-keyword-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .search-section {
            margin-bottom: 40px;
        }

        .search-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .search-form {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .keyword-input {
            flex: 1;
            min-width: 300px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .keyword-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .discovery-results {
            margin: 40px 0;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .result-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }

        .result-section h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .analysis-content, .keywords-list {
            min-height: 100px;
        }

        .discovery-tips {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }

        .discovery-tips h4 {
            color: #2e7d32;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .discovery-tips ul {
            list-style: none;
            padding: 0;
        }

        .discovery-tips li {
            margin-bottom: 12px;
            padding-left: 20px;
            position: relative;
            line-height: 1.5;
        }

        .discovery-tips li:before {
            content: "üí°";
            position: absolute;
            left: 0;
        }

        .discovery-logic-explanation {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .discovery-logic-explanation h5 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 8px;
        }

        .logic-steps {
            margin-bottom: 20px;
        }

        .logic-item {
            background: white;
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            line-height: 1.6;
        }

        .discovery-tips-mini {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #b3e5fc;
        }

        .discovery-tips-mini h5 {
            color: #0277bd;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .discovery-tips-mini ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .discovery-tips-mini li {
            margin-bottom: 8px;
            padding-left: 15px;
            position: relative;
            font-size: 14px;
            line-height: 1.4;
        }

        .discovery-tips-mini li:before {
            content: "‚ú®";
            position: absolute;
            left: 0;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
            }
            
            .keyword-input {
                min-width: 100%;
            }
            
            .back-btn {
                position: relative;
                margin-bottom: 20px;
            }
            
            .keyword-discovery-header h1 {
                font-size: 2em;
            }
        }

        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .login-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 40px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }

        .login-modal h3 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.5em;
        }

        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1003;
            backdrop-filter: blur(5px);
        }

        .settings-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .settings-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-header h3 {
            margin: 0;
            font-size: 1.4em;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .close-modal:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .settings-body {
            padding: 30px;
        }

        .settings-footer {
            padding: 20px 30px;
            border-top: 1px solid #eee;
            text-align: center;
        }

        .save-settings-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .save-settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .save-settings-btn:active {
            transform: translateY(0);
        }

        .keyword-choice-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1004;
            backdrop-filter: blur(5px);
        }

        .keyword-choice-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .keyword-choice-header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .keyword-choice-header h3 {
            margin: 0;
            font-size: 1.3em;
        }

        .keyword-choice-body {
            padding: 30px;
        }

        .selected-keyword-info {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
            border-radius: 10px;
            border: 1px solid #ffcccb;
        }

        .keyword-label {
            font-size: 14px;
            color: #666;
            display: block;
            margin-bottom: 8px;
        }

        .selected-keyword {
            font-size: 18px;
            font-weight: 700;
            color: #e53e3e;
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
            box-shadow: 0 2px 8px rgba(229, 62, 62, 0.2);
        }

        .choice-description {
            text-align: center;
            margin-bottom: 25px;
            color: #555;
            font-size: 16px;
        }

        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .choice-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .choice-btn:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .choice-btn.main-search-btn:hover {
            border-color: #2196F3;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        .choice-btn.keyword-discovery-btn-choice:hover {
            border-color: #9C27B0;
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
        }

        .btn-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .btn-content {
            flex: 1;
        }

        .btn-title {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .btn-description {
            font-size: 13px;
            color: #718096;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .keyword-choice-modal-content {
                width: 95%;
                margin: 20px;
            }
            
            .choice-buttons {
                gap: 12px;
            }
            
            .choice-btn {
                padding: 15px;
            }
            
            .btn-title {
                font-size: 15px;
            }
            
            .btn-description {
                font-size: 12px;
            }
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-form input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .login-form input:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .login-form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .login-submit-btn {
            flex: 1;
            background: #2196F3;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-submit-btn:hover {
            background: #1976D2;
        }

        .login-cancel-btn {
            flex: 1;
            background: #6c757d;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-cancel-btn:hover {
            background: #5a6268;
        }

        .form-container {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            line-height: 1.5;
        }

        .api-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .api-section h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .generate-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .generate-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2196F3;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result {
            display: none;
            margin-top: 30px;
            padding: 25px;
            background: #e8f5e8;
            border-radius: 10px;
            border-left: 5px solid #4CAF50;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .result h3 {
            color: #2e7d32;
            margin: 0;
        }

        .copy-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #1976D2;
            transform: translateY(-1px);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        .copy-btn.copied {
            background: #4CAF50;
        }
        
        .ai-generate-btn {
            background: #9C27B0;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .ai-generate-btn:hover {
            background: #7B1FA2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3);
        }
        
        .ai-generate-btn:active {
            transform: translateY(0);
        }
        
        .ai-generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .gemini-generate-btn {
            background: #4285F4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .gemini-generate-btn:hover {
            background: #3367D6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
        }
        
        .gemini-generate-btn:active {
            transform: translateY(0);
        }
        
        .gemini-generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .ai-generate-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .second-generation-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .text-replacement-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .text-replacement-section h4 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 16px;
        }
        
        .replacement-fields {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .replacement-fields {
                grid-template-columns: 1fr;
            }
        }
        
        .ai-result {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .ai-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .ai-result h3 {
            color: white;
            margin: 0;
            font-size: 1.3em;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .ai-result-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 20px;
            white-space: pre-wrap;
            line-height: 1.8;
            font-size: 15px;
            color: #333;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
            min-height: 200px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .compare-btn {
            background: #FF5722;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 15px;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .compare-btn:hover {
            background: #E64A19;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 87, 34, 0.3);
        }
        
        .compare-btn:active {
            transform: translateY(0);
        }
        
        .comparison-result {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .comparison-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .comparison-header h3 {
            color: #333;
            margin: 0;
            font-size: 1.3em;
        }
        
        .comparison-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            line-height: 1.8;
            font-size: 15px;
            max-height: 700px;
            overflow-y: auto;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .comparison-paragraph {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #ddd;
        }
        
        .original-text {
            background: #f8f9fa;
            border-left-color: #6c757d;
            color: #212529;
        }
        
        .ai-text {
            background: #fff5f5;
            border-left-color: #dc3545;
            color: #dc3545;
        }
        
        .paragraph-label {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.8;
        }
        
        .blog-selection-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            margin-bottom: 15px;
            justify-content: center;
        }
        
        .blog-select-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 140px;
            max-width: 180px;
        }
        
        .blog-select-btn:hover {
            background: #45a049;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }
        
        .blog-select-btn:active {
            transform: translateY(0);
        }
        
        .blog-select-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .blog-select-btn.all-blogs {
            background: #FF9800;
            font-weight: 600;
        }
        
        .blog-select-btn.all-blogs:hover {
            background: #F57C00;
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3);
        }
        
        @media (max-width: 768px) {
            .blog-selection-buttons {
                flex-direction: column;
            }
            
            .blog-select-btn {
                max-width: none;
            }
        }


        .fetch-blogs-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            margin: 10px 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .fetch-blogs-btn:hover {
            background: #1976D2;
            transform: translateY(-1px);
        }

        .fetch-blogs-btn:active {
            transform: translateY(0);
        }

        .fetch-blogs-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .url-input-section {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid #e0f2e0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .url-input-section h3 {
            color: #2e7d32;
            margin: 0 0 15px 0;
            font-size: 1.1em;
            font-weight: 600;
            text-align: center;
        }

        .url-fetch-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin-top: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .url-fetch-btn:hover {
            background: #45a049;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .url-fetch-btn:active {
            transform: translateY(0);
        }

        .url-fetch-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .blog-posts-results {
            display: none;
            margin-top: 25px;
            padding: 25px;
            background: #f0f8ff;
            border-radius: 10px;
            border-left: 5px solid #2196F3;
        }

        .blog-posts-results h3 {
            color: #1976D2;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .blog-post-item {
            background: white;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e3f2fd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .blog-post-item:last-child {
            margin-bottom: 0;
        }

        .blog-post-header {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
        }

        .blog-post-header input[type="radio"] {
            margin-top: 4px;
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .blog-post-title {
            font-weight: bold;
            color: #1976D2;
            font-size: 1.1em;
            line-height: 1.4;
            cursor: pointer;
            flex: 1;
        }

        .blog-post-title:hover {
            color: #1565C0;
            text-decoration: underline;
        }

        .blog-post-content {
            color: #555;
            line-height: 1.6;
            margin-bottom: 10px;
            white-space: pre-wrap;
        }

        .blog-post-link {
            font-size: 0.9em;
            color: #2196F3;
            text-decoration: none;
            display: inline-block;
            margin-top: 8px;
        }

        .blog-post-link:hover {
            text-decoration: underline;
        }

        .first-post-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .first-post-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .first-post-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }


        .prompt-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .prompt-btn {
            background: #6366F1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .prompt-btn:hover {
            background: #5B57EB;
            transform: translateY(-1px);
        }

        .prompt-btn.secondary {
            background: #10B981;
        }

        .prompt-btn.secondary:hover {
            background: #059669;
        }

        .prompt-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .prompt-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }

        .prompt-modal h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .prompt-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .prompt-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .prompt-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .prompt-item-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }

        .prompt-item-content {
            color: #6c757d;
            font-size: 14px;
            line-height: 1.4;
        }

        .prompt-form {
            display: none;
        }

        .prompt-form.show {
            display: block;
        }

        .prompt-form input,
        .prompt-form textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 15px;
            font-family: inherit;
        }

        .prompt-form input:focus,
        .prompt-form textarea:focus {
            outline: none;
            border-color: #6366F1;
        }

        .prompt-form-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close-modal:hover {
            color: #333;
        }

        .result-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            line-height: 1.6;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }

        .error {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #ffebee;
            color: #c62828;
            border-radius: 8px;
            border-left: 5px solid #f44336;
        }

        .info-box {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 5px solid #2196F3;
        }

        .info-box h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #424242;
            line-height: 1.5;
        }

        .search-results {
            display: none;
            margin-top: 25px;
            padding: 25px;
            background: #fff3e0;
            border-radius: 10px;
            border-left: 5px solid #ff9800;
        }

        .search-results h3 {
            color: #e65100;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .search-item {
            background: white;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ffcc02;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .search-item:last-child {
            margin-bottom: 0;
        }

        .search-item-title {
            font-weight: bold;
            color: #d84315;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .search-item-content {
            color: #555;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .search-item-link {
            font-size: 0.9em;
            color: #1976d2;
            text-decoration: none;
        }

        .search-item-link:hover {
            text-decoration: underline;
        }


        .keyword-input-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .keyword-input-section input {
            width: 70%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            margin-right: 10px;
        }

        .keyword-analyze-btn {
            background: #9C27B0;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .keyword-analyze-btn:hover {
            background: #7B1FA2;
        }

        .keyword-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .keyword-result-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .keyword-result-card h4 {
            color: #9C27B0;
            margin-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .keyword-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .keyword-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            gap: 15px;
        }

        .keyword-item:last-child {
            border-bottom: none;
        }

        .keyword-item > div:first-child {
            flex: 1;
            min-width: 0;
        }

        .keyword-name {
            font-weight: bold;
            color: #333;
            word-wrap: break-word;
            word-break: break-all;
            line-height: 1.4;
            max-width: 200px;
        }

        .keyword-stats {
            display: flex;
            gap: 8px;
            font-size: 11px;
            flex-direction: column;
            align-items: flex-end;
            min-width: 120px;
        }

        @media (min-width: 768px) {
            .keyword-stats {
                flex-direction: row;
                align-items: center;
                font-size: 12px;
                gap: 10px;
                min-width: 200px;
            }
        }

        .keyword-volume {
            background: #4CAF50;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .keyword-competition {
            background: #FF9800;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .keyword-competition.low {
            background: #4CAF50;
        }

        .keyword-competition.medium {
            background: #FF9800;
        }

        .keyword-competition.high {
            background: #f44336;
        }

        .keyword-select-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .keyword-select-btn:hover {
            background: #1976D2;
        }

        .keyword-usage-guide {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }

        .keyword-usage-guide h3 {
            color: #9C27B0;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.3em;
        }

        .usage-steps {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .usage-step {
            display: flex;
            align-items: flex-start;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #9C27B0;
        }

        .step-number {
            background: #9C27B0;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .step-content h4 {
            color: #333;
            margin: 0 0 8px 0;
            font-size: 1.1em;
        }

        .step-content p {
            color: #666;
            margin: 0;
            line-height: 1.5;
        }

        .usage-tips {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #2196F3;
        }

        .usage-tips h4 {
            color: #1976D2;
            margin: 0 0 15px 0;
            font-size: 1.1em;
        }

        .usage-tips ul {
            margin: 0;
            padding-left: 20px;
        }

        .usage-tips li {
            color: #424242;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .usage-tips li:last-child {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <div class="header-nav">
                    <button class="keyword-discovery-btn" onclick="showKeywordDiscovery()">üîç ÌÇ§ÏõåÎìúÎ∞úÍµ¥</button>
                </div>
                <div class="login-area" id="loginArea">
                    <button class="login-btn" id="loginBtn" onclick="showLoginModal()">üë§ Î°úÍ∑∏Ïù∏</button>
                    <button class="settings-btn" id="settingsBtn" onclick="showSettingsModal()" title="ÏÑ§Ï†ï">‚öôÔ∏è</button>
                </div>
            </div>
            <h1>Î∏îÎ°úÍ∑∏ ÏûêÎèô ÏûëÏÑ±Í∏∞</h1>
        </div>

        <div class="form-container">
            <div class="info-box">
                <h4>üí° ÏÇ¨Ïö© Î∞©Î≤ï</h4>
                <p><strong>ÎÑ§Ïù¥Î≤Ñ Í≤ÄÏÉâ APIÏôÄ Claude AIÎ•º ÌôúÏö©Ìïú SEO ÏµúÏ†ÅÌôî Î∏îÎ°úÍ∑∏ Í∏Ä ÏÉùÏÑ±</strong></p>
                <p>ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•ÌïòÍ≥† ÎÑ§Ïù¥Î≤Ñ Í≤ÄÏÉâ APIÏôÄ Claude API ÌÇ§Î•º ÏûÖÎ†•ÌïòÎ©¥, Ìï¥Îãπ ÌÇ§ÏõåÎìúÎ°ú ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏Î•º Í≤ÄÏÉâÌïòÏó¨ Ï∞∏Í≥† ÏûêÎ£åÎ•º ÏàòÏßëÌïòÍ≥†, SEO ÏµúÏ†ÅÌôîÎêú 2000Ïûê Î∂ÑÎüâÏùò Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±Ìï©ÎãàÎã§.</p>
            </div>

            <form id="blogForm">
                <div class="form-group">
                    <label for="keyword">Í≤ÄÏÉâ ÌÇ§ÏõåÎìú</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="keyword" name="keyword" placeholder="Î∏îÎ°úÍ∑∏ Í∏Ä Ï£ºÏ†ú ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required style="flex: 1;">
                    </div>
                </div>




                <button type="button" class="fetch-blogs-btn" onclick="fetchBlogPosts()">
                    üìÑ Î∏îÎ°úÍ∑∏Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞
                </button>


            </form>

            <div class="blog-posts-results" id="blogPostsResults">
                <h3>üìÑ Í∞ÄÏ†∏Ïò® Î∏îÎ°úÍ∑∏ Í∏Ä Î™©Î°ù</h3>
                <div id="blogPostsList"></div>
                <div class="blog-selection-buttons" id="blogSelectionButtons" style="display: none;">
                    <button type="button" class="blog-select-btn" onclick="scrapeSelectedBlog()">
                        üìÑ ÏÑ†ÌÉùÎêúÎÇ¥Ïö© Í∞ÄÏ†∏Ïò§Í∏∞
                    </button>
                </div>
            </div>

            <div class="search-results" id="searchResults">
                <h3>üìã ÏàòÏßëÎêú ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ Í≤ÄÏÉâ Í≤∞Í≥º</h3>
                <div id="searchResultsList"></div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>ÎÑ§Ïù¥Î≤ÑÏóêÏÑú Í≤ÄÏÉâ Ï§ëÏù¥Í≥† Claude AIÍ∞Ä Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ ÏÉùÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§...<br>Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.</p>
            </div>

            <div class="error" id="error"></div>

            <!-- URL ÏûÖÎ†• ÏÑπÏÖò -->
            <div class="url-input-section">
                <h3>üîó ÏßÅÏ†ë URL ÏûÖÎ†•</h3>
                <div class="form-group">
                    <input type="url" id="directUrlInput" placeholder="ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ïòà: https://blog.naver.com/blogid/123456)" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                </div>
                <button type="button" class="url-fetch-btn" onclick="fetchFromDirectUrl()">
                    üîó URLÏóêÏÑú Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞
                </button>
            </div>

            <div class="result" id="result">
                <div class="result-header">
                    <h3>üìÑ Ïä§ÌÅ¨Îû©ÎêúÍ∏Ä</h3>
                    <button class="copy-btn" id="copyBtn" onclick="copyToClipboard()">
                        üìã Î≥µÏÇ¨ÌïòÍ∏∞
                    </button>
                </div>
                <div class="result-content" id="resultContent"></div>
            </div>
            
            <!-- AI ÌîÑÎ°¨ÌîÑÌä∏ ÏÑπÏÖò -->
            <div class="ai-prompt-section" id="aiPromptSection" style="display: none;">
                <h3>ü§ñ AI ÌîÑÎ°¨ÌîÑÌä∏ ÏÑ§Ï†ï</h3>
                <div class="form-group">
                    <label for="aiPrompt">AI ÌîÑÎ°¨ÌîÑÌä∏</label>
                    <textarea id="aiPrompt" name="aiPrompt" rows="16" placeholder="AIÍ∞Ä Ïñ¥Îñ§ Ïä§ÌÉÄÏùºÎ°ú Í∏ÄÏùÑ ÏûëÏÑ±ÌïòÍ∏∏ ÏõêÌïòÎäîÏßÄ Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú ÏÑ§Î™ÖÌï¥Ï£ºÏÑ∏Ïöî. Ïòà: 'Ï¥àÎ≥¥ÏûêÎèÑ Ïù¥Ìï¥ÌïòÍ∏∞ ÏâΩÍ≤å ÏπúÍ∑ºÌïú ÎßêÌà¨Î°ú ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî', 'Ï†ÑÎ¨∏Ï†ÅÏù¥Í≥† Ïã†Î¢∞Ìï† Ïàò ÏûàÎäî ÎÇ¥Ïö©ÏúºÎ°ú ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî' Îì±" required></textarea>
                    <div class="prompt-controls">
                        <button type="button" class="prompt-btn" onclick="showPromptModal()">üìù AI ÌîÑÎ°¨ÌîÑÌä∏ Ï°∞Ìöå</button>
                    </div>
                    
                    <!-- ÌÖçÏä§Ìä∏ ÎåÄÏ≤¥ ÌïÑÎìúÎì§ -->
                    <div class="text-replacement-section">
                        <h4>üîÑ ÌÖçÏä§Ìä∏ ÎåÄÏ≤¥ (ÏÑ†ÌÉùÏÇ¨Ìï≠)</h4>
                        <div class="replacement-fields">
                            <div class="form-group">
                                <label for="replaceText">ÎåÄÏ≤¥Ìï†ÌÖçÏä§Ìä∏</label>
                                <input type="text" id="replaceText" name="replaceText" placeholder="Ïä§ÌÅ¨Îû©Îêú Í∏ÄÏóêÏÑú Î∞îÍøÄ ÌÖçÏä§Ìä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                            </div>
                            <div class="form-group">
                                <label for="newText">ÏÉàÎ°úÏö¥ÌÖçÏä§Ìä∏</label>
                                <input type="text" id="newText" name="newText" placeholder="ÏÉàÎ°ú Î∞îÍøÄ ÌÖçÏä§Ìä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ai-generate-buttons">
                    <button type="button" class="ai-generate-btn" id="aiGenerateBtn" onclick="generateAIContent()" style="display: none;">
                        ü§ñ ClaudeÎ°ú Í∏ÄÏÉùÏÑ±ÌïòÍ∏∞
                    </button>
                    <button type="button" class="gemini-generate-btn" id="geminiGenerateBtn" onclick="generateGeminiContent()" style="display: none;">
                        üíé GeminiÎ°ú Í∏ÄÏÉùÏÑ±ÌïòÍ∏∞
                    </button>
                </div>
            </div>
            
            <!-- AI ÏÉùÏÑ±Îêú Í∏Ä ÏÑπÏÖò -->
            <div class="ai-result" id="aiResult" style="display: none;">
                <div class="ai-result-header">
                    <h3>‚ú® Ï≤´Î≤àÏß∏ ÏÉùÏÑ±ÎêúÍ∏Ä</h3>
                    <button class="copy-btn" id="aiCopyBtn" onclick="copyAIToClipboard()">
                        üìã Î≥µÏÇ¨ÌïòÍ∏∞
                    </button>
                </div>
                <div class="ai-result-content" id="aiResultContent"></div>
                <button type="button" class="compare-btn" id="compareBtn" onclick="compareTexts()" style="display: none;">
                    üìä ÏõêÎ¨∏Í≥º ÎπÑÍµêÌïòÍ∏∞
                </button>
                <div class="second-generation-buttons" id="secondGenerationButtons" style="display: none;">
                    <button type="button" class="ai-generate-btn" id="generateFromFirstClaudeBtn" onclick="generateFromFirstClaude()">
                        ü§ñ Ï≤´Î≤àÏß∏ ÏÉùÏÑ±ÎêúÍ∏ÄÎ°ú Claude Í∏ÄÏûëÏÑ±ÌïòÍ∏∞
                    </button>
                    <button type="button" class="gemini-generate-btn" id="generateFromFirstGeminiBtn" onclick="generateFromFirstGemini()">
                        üíé Ï≤´Î≤àÏß∏ ÏÉùÏÑ±ÎêúÍ∏ÄÎ°ú Gemini Í∏ÄÏûëÏÑ±ÌïòÍ∏∞
                    </button>
                </div>
            </div>
            
            <!-- ÎëêÎ≤àÏß∏ AI ÏÉùÏÑ±Îêú Í∏Ä ÏÑπÏÖò -->
            <div class="ai-result" id="aiResult2" style="display: none;">
                <div class="ai-result-header">
                    <h3>‚ú® ÎëêÎ≤àÏß∏ ÏÉùÏÑ±ÎêúÍ∏Ä</h3>
                    <button class="copy-btn" id="aiCopyBtn2" onclick="copyAI2ToClipboard()">
                        üìã Î≥µÏÇ¨ÌïòÍ∏∞
                    </button>
                </div>
                <div class="ai-result-content" id="aiResultContent2"></div>
                <button type="button" class="compare-btn" id="compareBtn2" onclick="compareTexts2()" style="display: none;">
                    üìä ÏõêÎ¨∏Í≥º ÎπÑÍµêÌïòÍ∏∞
                </button>
            </div>
            
            <!-- ÏõêÎ¨∏Í≥º ÎπÑÍµêÌïòÍ∏∞ ÏÑπÏÖò -->
            <div class="comparison-result" id="comparisonResult" style="display: none;">
                <div class="comparison-header">
                    <h3>üìä ÏõêÎ¨∏Í≥º ÎπÑÍµêÌïòÍ∏∞</h3>
                </div>
                <div class="comparison-content" id="comparisonContent"></div>
            </div>
        </div>
    </div>

    <!-- AI ÌîÑÎ°¨ÌîÑÌä∏ Í¥ÄÎ¶¨ Î™®Îã¨ -->
    <div class="prompt-modal" id="promptModal">
        <div class="prompt-modal-content">
            <button class="close-modal" onclick="closePromptModal()">√ó</button>
            
            <!-- ÌîÑÎ°¨ÌîÑÌä∏ Î™©Î°ù Î≥¥Í∏∞ -->
            <div id="promptListView">
                <h3>üí° Ï†ÄÏû•Îêú AI ÌîÑÎ°¨ÌîÑÌä∏ Î™©Î°ù</h3>
                <div class="prompt-list" id="promptList">
                    <!-- ÌîÑÎ°¨ÌîÑÌä∏ Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                </div>
                <div class="prompt-form-buttons">
                    <button type="button" class="prompt-btn secondary" onclick="showNewPromptForm()">‚ûï ÏÉà ÌîÑÎ°¨ÌîÑÌä∏ Ï∂îÍ∞Ä</button>
                    <button type="button" class="prompt-btn" onclick="closePromptModal()">Îã´Í∏∞</button>
                </div>
            </div>

            <!-- ÌîÑÎ°¨ÌîÑÌä∏ Îì±Î°ù/ÏàòÏ†ï Ìèº -->
            <div class="prompt-form" id="promptForm">
                <h3 id="promptFormTitle">üÜï ÏÉà AI ÌîÑÎ°¨ÌîÑÌä∏ Îì±Î°ù</h3>
                <form id="promptFormElement">
                    <input type="hidden" id="promptId" name="promptId">
                    <input type="text" id="promptTitle" name="title" placeholder="ÌîÑÎ°¨ÌîÑÌä∏ Ï†úÎ™© (Ïòà: ÏπúÍ∑ºÌïú Î∏îÎ°úÍ∑∏ Ïä§ÌÉÄÏùº)" required>
                    <textarea id="promptContent" name="content" rows="4" placeholder="AI ÌîÑÎ°¨ÌîÑÌä∏ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required></textarea>
                    <div class="prompt-form-buttons">
                        <button type="button" class="prompt-btn" onclick="cancelPromptForm()">Ï∑®ÏÜå</button>
                        <button type="submit" class="prompt-btn secondary" id="promptSubmitBtn">Ï†ÄÏû•</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- ÌÇ§ÏõåÎìúÎ∞úÍµ¥ ÌôîÎ©¥ -->
    <div class="keyword-discovery-page" id="keywordDiscoveryPage" style="display: none;">
        <div class="keyword-discovery-container">
            <div class="keyword-discovery-header">
                <button class="back-btn" onclick="hideKeywordDiscovery()">‚Üê ÎêòÎèåÏïÑÍ∞ÄÍ∏∞</button>
                <h1>üîç ÌÇ§ÏõåÎìúÎ∞úÍµ¥</h1>
                <p>Ìö®Í≥ºÏ†ÅÏù∏ ÌÇ§ÏõåÎìúÎ•º Î∞úÍµ¥ÌïòÏó¨ Î∏îÎ°úÍ∑∏ ÏΩòÌÖêÏ∏†Î•º ÏµúÏ†ÅÌôîÌïòÏÑ∏Ïöî</p>
            </div>

            <div class="keyword-discovery-content">
                <div class="new-keyword-section">
                    <button class="new-keyword-btn" onclick="discoverNewKeywords()">üÜï Ïã†Í∑úÌÇ§ÏõåÎìú Í≤ÄÏÉâ</button>
                </div>
                
                <div class="search-section">
                    <h3>üéØ ÌÇ§ÏõåÎìú Í≤ÄÏÉâ</h3>
                    <div class="search-form">
                        <input type="text" id="keywordDiscoveryInput" placeholder="Í∏∞Î≥∏ ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ïòà: ÏóêÏñ¥Ïª®Ï≤≠ÏÜå, Ïπ¥ÌéòÏ∞ΩÏóÖ)" class="keyword-input">
                        <button class="search-btn" onclick="startKeywordDiscovery()">üîç ÌÇ§ÏõåÎìú Î∞úÍµ¥ ÏãúÏûë</button>
                    </div>
                </div>

                <div class="discovery-results" id="discoveryResults" style="display: none;">
                    <div class="results-grid">
                        <div class="result-section">
                            <h4>üìä Í∏∞Î≥∏ ÌÇ§ÏõåÎìú Î∂ÑÏÑù</h4>
                            <div id="basicAnalysis" class="analysis-content">
                                <div class="discovery-logic-explanation">
                                    <h5>üöÄ Ïã†Í∑ú ÌÇ§ÏõåÎìú Î∞úÍµ¥ Î°úÏßÅ</h5>
                                    <div class="logic-steps">
                                        <div class="logic-item">
                                            <strong>1Ô∏è‚É£ Ïó∞Í¥Ä ÌÇ§ÏõåÎìú Î∂ÑÏÑù:</strong> ÏûÖÎ†• ÌÇ§ÏõåÎìúÏùò ÎèôÏùòÏñ¥, Ïú†ÏùòÏñ¥, Í¥ÄÎ†® ÏóÖÏ¢Ö Ïö©Ïñ¥Î•º ÏûêÎèô Ï∂îÏ∂úÌïòÏó¨ ÌÇ§ÏõåÎìú ÌíÄÏùÑ ÌôïÏû•Ìï©ÎãàÎã§.
                                        </div>
                                        <div class="logic-item">
                                            <strong>2Ô∏è‚É£ Î°±ÌÖåÏùº ÌÇ§ÏõåÎìú ÏÉùÏÑ±:</strong> "Ï£ºÏöîÌÇ§ÏõåÎìú + ÏàòÏãùÏñ¥ + Î™©Ï†ÅÏñ¥" Ìå®ÌÑ¥ÏúºÎ°ú Í≤ÄÏÉâ ÏùòÎèÑÍ∞Ä Î™ÖÌôïÌïú 3-5Îã®Ïñ¥ Ï°∞Ìï©ÏùÑ ÏÉùÏÑ±Ìï©ÎãàÎã§.
                                        </div>
                                        <div class="logic-item">
                                            <strong>3Ô∏è‚É£ ÏßÄÏó≠ Í∏∞Î∞ò ÌÇ§ÏõåÎìú:</strong> "ÏßÄÏó≠Î™Ö + ÏÑúÎπÑÏä§/ÏÉÅÌíàÎ™Ö" Ìå®ÌÑ¥ÏúºÎ°ú Î°úÏª¨ SEO ÏµúÏ†ÅÌôî ÌÇ§ÏõåÎìúÎ•º Î∞úÍµ¥Ìï©ÎãàÎã§.
                                        </div>
                                        <div class="logic-item">
                                            <strong>4Ô∏è‚É£ ÏùòÎèÑ Í∏∞Î∞ò Î∂ÑÎ•ò:</strong> Ï†ïÎ≥¥ÏÑ±("Î∞©Î≤ï", "ÌåÅ"), Íµ¨Îß§ÏÑ±("Í∞ÄÍ≤©", "Ìï†Ïù∏"), ÎπÑÍµêÏÑ±("vs", "Ï∞®Ïù¥"), Î¨∏Ï†úÌï¥Í≤∞("Ìï¥Í≤∞", "Î¨∏Ï†ú") ÌÇ§ÏõåÎìúÎ°ú Î∂ÑÎ•òÌï©ÎãàÎã§.
                                        </div>
                                        <div class="logic-item">
                                            <strong>5Ô∏è‚É£ Ìä∏Î†åÎìú ÌÇ§ÏõåÎìú:</strong> ÌòÑÏû¨ ÏãúÍ∏∞Ïùò Ïù¥Î≤§Ìä∏, ÏãúÏ¶å, ÏÇ¨ÌöåÏ†Å Ïù¥ÏäàÏôÄ Ïó∞Í≤∞Îêú ÌÇ§ÏõåÎìúÎ•º ÏûêÎèô Ï∂îÏ≤úÌï©ÎãàÎã§.
                                        </div>
                                        <div class="logic-item">
                                            <strong>6Ô∏è‚É£ Í≤ΩÏüÅ Î∂ÑÏÑù:</strong> ÎÑ§Ïù¥Î≤Ñ Í≤ÄÏÉâ ÏÉÅÏúÑ ÌéòÏù¥ÏßÄ Î∂ÑÏÑùÏùÑ ÌÜµÌï¥ Í≤ΩÏüÅÏù¥ ÎÇÆÏùÄ ÎåÄÏïà ÌÇ§ÏõåÎìúÎ•º Î∞úÍµ¥Ìï©ÎãàÎã§.
                                        </div>
                                    </div>
                                    
                                    <div class="discovery-tips-mini">
                                        <h5>üí° ÌÇ§ÏõåÎìú ÌôúÏö© ÌïµÏã¨ ÌåÅ</h5>
                                        <ul>
                                            <li><strong>ÌÉÄÍ≤üÌåÖ:</strong> Î∏åÎ°úÎìúÎ≥¥Îã§ Î°±ÌÖåÏùº ÌÇ§ÏõåÎìúÍ∞Ä Ï†ÑÌôòÏú®Ïù¥ ÎÜíÏùå</li>
                                            <li><strong>SEO:</strong> ÏûêÏó∞Ïä§Îü¨Ïö¥ ÌÇ§ÏõåÎìú Î∞∞Ïπò, Í≥ºÎèÑÌïú Ïä§ÌÑ∞Ìïë Í∏àÏßÄ</li>
                                            <li><strong>Î™®ÎãàÌÑ∞ÎßÅ:</strong> Ï†ïÍ∏∞Ï†Å ÏÑ±Í≥º Î∂ÑÏÑù Î∞è Ìä∏Î†åÎìú ÏóÖÎç∞Ïù¥Ìä∏</li>
                                            <li><strong>Í≥ÑÏ†àÏÑ±:</strong> ÏãúÍ∏∞Î≥Ñ Ïù¥Î≤§Ìä∏Ïóê ÎßûÏ∂ò ÏΩòÌÖêÏ∏† Ï§ÄÎπÑ</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="result-section">
                            <h4>üîó Ïó∞Í¥Ä ÌÇ§ÏõåÎìú</h4>
                            <div id="relatedKeywords" class="keywords-list"></div>
                        </div>
                        
                        <div class="result-section">
                            <h4>üìà Î°±ÌÖåÏùº ÌÇ§ÏõåÎìú</h4>
                            <div id="longTailKeywords" class="keywords-list"></div>
                        </div>
                        
                        <div class="result-section">
                            <h4>üöÄ Í∏âÏÉÅÏäπ ÌÇ§ÏõåÎìú</h4>
                            <div id="trendingKeywords" class="keywords-list"></div>
                        </div>
                    </div>
                </div>

                <div class="discovery-tips">
                    <h4>üí° ÌÇ§ÏõåÎìúÎ∞úÍµ¥ ÌåÅ</h4>
                    <ul>
                        <li><strong>Î°±ÌÖåÏùº ÌÇ§ÏõåÎìú:</strong> 3-4Îã®Ïñ¥ Ï°∞Ìï©ÏúºÎ°ú Í≤ΩÏüÅÏù¥ ÎÇÆÍ≥† Ï†ÑÌôòÏú®Ïù¥ ÎÜíÏäµÎãàÎã§</li>
                        <li><strong>ÏßÄÏó≠ ÌÇ§ÏõåÎìú:</strong> "ÏßÄÏó≠Î™Ö + ÏÑúÎπÑÏä§"Î°ú Î°úÏª¨ SEOÏóê Ìö®Í≥ºÏ†ÅÏûÖÎãàÎã§</li>
                        <li><strong>Î¨∏Ï†ú Ìï¥Í≤∞ ÌÇ§ÏõåÎìú:</strong> "Î∞©Î≤ï", "Ìï¥Í≤∞", "ÌåÅ" Îì±ÏùÑ Ìè¨Ìï®Ìïú ÌÇ§ÏõåÎìúÏûÖÎãàÎã§</li>
                        <li><strong>Í≥ÑÏ†àÏÑ± ÌÇ§ÏõåÎìú:</strong> ÏãúÍ∏∞Î≥Ñ Ìä∏Î†åÎìúÎ•º Í≥†Î†§Ìïú ÌÇ§ÏõåÎìúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Î°úÍ∑∏Ïù∏ Î™®Îã¨ -->
    <div class="login-modal" id="loginModal">
        <div class="login-modal-content">
            <h3>üîê Î°úÍ∑∏Ïù∏</h3>
            <form class="login-form" id="loginForm">
                <input type="text" id="loginId" name="id" placeholder="ÏïÑÏù¥Îîî" required>
                <input type="password" id="loginPassword" name="password" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏" required>
                <div class="login-form-buttons">
                    <button type="button" class="login-cancel-btn" onclick="closeLoginModal()">Ï∑®ÏÜå</button>
                    <button type="submit" class="login-submit-btn">Î°úÍ∑∏Ïù∏</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ÏÑ§Ï†ï Î™®Îã¨ -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-modal-content">
            <div class="settings-header">
                <h3>‚öôÔ∏è API ÏÑ§Ï†ï</h3>
                <button class="close-modal" onclick="closeSettingsModal()">√ó</button>
            </div>
            
            <div class="settings-body">
                <div class="api-section">
                    <h4>üîë ÎÑ§Ïù¥Î≤Ñ Í≤ÄÏÉâ API ÏÑ§Ï†ï</h4>
                    <div class="form-group">
                        <label for="naverClientId">ÎÑ§Ïù¥Î≤Ñ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ID</label>
                        <input type="text" id="naverClientId" name="naverClientId" placeholder="ÎÑ§Ïù¥Î≤Ñ Í∞úÎ∞úÏûêÏÑºÌÑ∞ÏóêÏÑú Î∞úÍ∏âÎ∞õÏùÄ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ID" required>
                    </div>
                    <div class="form-group">
                        <label for="naverClientSecret">ÎÑ§Ïù¥Î≤Ñ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏãúÌÅ¨Î¶ø</label>
                        <input type="password" id="naverClientSecret" name="naverClientSecret" placeholder="ÎÑ§Ïù¥Î≤Ñ Í∞úÎ∞úÏûêÏÑºÌÑ∞ÏóêÏÑú Î∞úÍ∏âÎ∞õÏùÄ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏãúÌÅ¨Î¶ø" required>
                    </div>
                </div>

                <div class="api-section">
                    <h4>ü§ñ Claude API ÏÑ§Ï†ï</h4>
                    <div class="form-group">
                        <label for="claudeApiKey">Claude API ÌÇ§</label>
                        <input type="password" id="claudeApiKey" name="claudeApiKey" placeholder="Anthropic ConsoleÏóêÏÑú Î∞úÍ∏âÎ∞õÏùÄ Claude API ÌÇ§" required>
                    </div>
                </div>

                <div class="api-section">
                    <h4>üîÆ Gemini API ÏÑ§Ï†ï</h4>
                    <div class="form-group">
                        <label for="geminiApiKey">Gemini API ÌÇ§</label>
                        <input type="password" id="geminiApiKey" name="geminiApiKey" placeholder="Google AI StudioÏóêÏÑú Î∞úÍ∏âÎ∞õÏùÄ Gemini API ÌÇ§">
                    </div>
                    <div class="form-group">
                        <small style="color: #666; font-size: 12px;">
                            üí° Gemini APIÎäî ÎåÄÏïà AI Î™®Îç∏Î°ú ÏÇ¨Ïö©Îê©ÎãàÎã§. Claude APIÍ∞Ä ÏóÜÍ±∞ÎÇò Ïã§Ìå®Ïãú ÏûêÎèôÏúºÎ°ú ÏÇ¨Ïö©Îê©ÎãàÎã§.
                        </small>
                    </div>
                </div>
            </div>
            
            <div class="settings-footer">
                <button class="save-settings-btn" onclick="saveApiSettings()">üíæ ÏÑ§Ï†ï Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- ÌÇ§ÏõåÎìú ÏÑ†ÌÉù Î™®Îã¨ -->
    <div class="keyword-choice-modal" id="keywordChoiceModal">
        <div class="keyword-choice-modal-content">
            <div class="keyword-choice-header">
                <h3>üéØ ÌÇ§ÏõåÎìú Ï†ÅÏö© ÏúÑÏπò ÏÑ†ÌÉù</h3>
                <button class="close-modal" onclick="closeKeywordChoiceModal()">√ó</button>
            </div>
            
            <div class="keyword-choice-body">
                <div class="selected-keyword-info">
                    <span class="keyword-label">ÏÑ†ÌÉùÎêú ÌÇ§ÏõåÎìú:</span>
                    <span class="selected-keyword" id="selectedKeywordText"></span>
                </div>
                
                <div class="choice-description">
                    <p>Ïù¥ ÌÇ§ÏõåÎìúÎ•º Ïñ¥Îäê ÏúÑÏπòÏóê Ï†ÅÏö©ÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
                </div>
                
                <div class="choice-buttons">
                    <button class="choice-btn main-search-btn" onclick="applyToMainSearch()">
                        <div class="btn-icon">üìÑ</div>
                        <div class="btn-content">
                            <div class="btn-title">Î≥∏Î¨∏ Í≤ÄÏÉâÌÇ§ÏõåÎìú ÌïÑÎìú</div>
                            <div class="btn-description">Î©îÏù∏ ÌôîÎ©¥Ïùò Í≤ÄÏÉâ ÌÇ§ÏõåÎìúÏóê ÏûÖÎ†•ÌïòÍ≥† Î∏îÎ°úÍ∑∏ Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìñâ</div>
                        </div>
                    </button>
                    
                    <button class="choice-btn keyword-discovery-btn-choice" onclick="applyToKeywordDiscovery()">
                        <div class="btn-icon">üîç</div>
                        <div class="btn-content">
                            <div class="btn-title">ÌÇ§ÏõåÎìúÎ∞úÍµ¥ ÌïÑÎìú</div>
                            <div class="btn-description">ÌÇ§ÏõåÎìúÎ∞úÍµ¥ ÌôîÎ©¥Ïùò ÏûÖÎ†•Ï∞ΩÏóê ÏûÖÎ†•ÌïòÍ≥† ÌÇ§ÏõåÎìú Î∞úÍµ¥ Ïû¨Ïã§Ìñâ</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú Í¥ÄÎ¶¨
        let currentUser = null;

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        window.addEventListener('DOMContentLoaded', async function() {
            // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú ÌôïÏù∏
            checkLoginStatus();
            
            // Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî (ÏµúÏ¥à Ïã§ÌñâÏãú)
            await initializeDefaultUsers();
            try {
                const response = await fetch('/load-api-keys');
                const data = await response.json();
                
                if (data.success && data.apiData) {
                    document.getElementById('naverClientId').value = data.apiData.naverClientId || '';
                    document.getElementById('naverClientSecret').value = data.apiData.naverClientSecret || '';
                    document.getElementById('claudeApiKey').value = data.apiData.claudeApiKey || '';
                    document.getElementById('geminiApiKey').value = data.apiData.geminiApiKey || '';
                    
                    // API ÌÇ§Í∞Ä Ïù¥ÎØ∏ Ï†ÄÏû•ÎêòÏñ¥ ÏûàÏñ¥ÎèÑ Í∏∞Î≥∏Ï†ÅÏúºÎ°ú ÏÑ§Ï†ïÏùÄ Ïà®Í≤®Îë†
                    // ÏÇ¨Ïö©ÏûêÍ∞Ä ÌïÑÏöîÌï† ÎïåÎßå 'ÏÑ§Ï†ïÎ≥¥Ïù¥Í∏∞' Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÌôïÏù∏
                }
            } catch (error) {
                console.log('Ï†ÄÏû•Îêú API ÌÇ§Í∞Ä ÏóÜÏäµÎãàÎã§.');
            }
        });

        // Í∏∞Ï°¥ Î∏îÎ°úÍ∑∏ ÏÉùÏÑ± Ìèº Ï†úÏ∂ú Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞Îê®

        function showSettingsModal() {
            document.getElementById('settingsModal').style.display = 'block';
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        async function saveApiSettings() {
            const naverClientId = document.getElementById('naverClientId').value;
            const naverClientSecret = document.getElementById('naverClientSecret').value;
            const claudeApiKey = document.getElementById('claudeApiKey').value;
            const geminiApiKey = document.getElementById('geminiApiKey').value;

            try {
                const response = await fetch('/save-api-keys', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        naverClientId,
                        naverClientSecret,
                        claudeApiKey,
                        geminiApiKey
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ API ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
                    closeSettingsModal();
                } else {
                    alert('‚ùå API ÏÑ§Ï†ï Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + data.error);
                }
            } catch (error) {
                console.error('API ÏÑ§Ï†ï Ï†ÄÏû• Ïò§Î•ò:', error);
                alert('‚ùå API ÏÑ§Ï†ï Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        function displaySearchResults(searchResults) {
            const resultsList = document.getElementById('searchResultsList');
            resultsList.innerHTML = '';
            
            searchResults.forEach((item, index) => {
                const title = item.title.replace(/<[^>]*>/g, '');
                const description = item.description.replace(/<[^>]*>/g, '');
                
                const searchItem = document.createElement('div');
                searchItem.className = 'search-item';
                searchItem.innerHTML = `
                    <div class="search-item-title">${index + 1}. ${title}</div>
                    <div class="search-item-content">${description}</div>
                    <a href="${item.link}" target="_blank" class="search-item-link">ÏõêÎ¨∏ Î≥¥Í∏∞ ‚Üí</a>
                `;
                resultsList.appendChild(searchItem);
            });
        }

        async function copyToClipboard() {
            const copyBtn = document.getElementById('copyBtn');
            const resultContent = document.getElementById('resultContent');
            
            if (!resultContent.textContent) {
                alert('Î≥µÏÇ¨Ìï† ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            try {
                // ÏµúÏã† Î∏åÎùºÏö∞Ï†ÄÏùò Clipboard API ÏÇ¨Ïö©
                await navigator.clipboard.writeText(resultContent.textContent);
                
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥ÄÍ≤Ω
                copyBtn.textContent = '‚úÖ Î≥µÏÇ¨ÏôÑÎ£å!';
                copyBtn.classList.add('copied');
                
                // 2Ï¥à ÌõÑ ÏõêÎûò ÏÉÅÌÉúÎ°ú Î≥µÏõê
                setTimeout(() => {
                    copyBtn.textContent = 'üìã Î≥µÏÇ¨ÌïòÍ∏∞';
                    copyBtn.classList.remove('copied');
                }, 2000);
                
            } catch (err) {
                // Clipboard APIÍ∞Ä ÏßÄÏõêÎêòÏßÄ ÏïäÎäî Í≤ΩÏö∞ ÎåÄÏ≤¥ Î∞©Î≤ï ÏÇ¨Ïö©
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = resultContent.textContent;
                    textArea.style.position = 'fixed';
                    textArea.style.top = '-9999px';
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    copyBtn.textContent = '‚úÖ Î≥µÏÇ¨ÏôÑÎ£å!';
                    copyBtn.classList.add('copied');
                    
                    setTimeout(() => {
                        copyBtn.textContent = 'üìã Î≥µÏÇ¨ÌïòÍ∏∞';
                        copyBtn.classList.remove('copied');
                    }, 2000);
                    
                } catch (fallbackErr) {
                    console.error('Î≥µÏÇ¨ Ïã§Ìå®:', fallbackErr);
                    alert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÏàòÎèôÏúºÎ°ú ÌÖçÏä§Ìä∏Î•º ÏÑ†ÌÉùÌïòÏó¨ Î≥µÏÇ¨Ìï¥Ï£ºÏÑ∏Ïöî.');
                }
            }
        }

        // AI ÌîÑÎ°¨ÌîÑÌä∏ Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
        let currentPrompts = [];

        async function showPromptModal() {
            await loadPrompts();
            showPromptListView();
            document.getElementById('promptModal').style.display = 'block';
        }

        function closePromptModal() {
            document.getElementById('promptModal').style.display = 'none';
        }

        function showPromptListView() {
            document.getElementById('promptListView').style.display = 'block';
            document.getElementById('promptForm').classList.remove('show');
        }

        function showNewPromptForm() {
            document.getElementById('promptFormTitle').textContent = 'üÜï ÏÉà AI ÌîÑÎ°¨ÌîÑÌä∏ Îì±Î°ù';
            document.getElementById('promptSubmitBtn').textContent = 'Ï†ÄÏû•';
            document.getElementById('promptFormElement').reset();
            document.getElementById('promptId').value = '';
            
            document.getElementById('promptListView').style.display = 'none';
            document.getElementById('promptForm').classList.add('show');
        }

        function editPrompt(prompt) {
            document.getElementById('promptFormTitle').textContent = '‚úèÔ∏è AI ÌîÑÎ°¨ÌîÑÌä∏ ÏàòÏ†ï';
            document.getElementById('promptSubmitBtn').textContent = 'ÏàòÏ†ï';
            document.getElementById('promptId').value = prompt.id;
            document.getElementById('promptTitle').value = prompt.title;
            document.getElementById('promptContent').value = prompt.content;
            
            document.getElementById('promptListView').style.display = 'none';
            document.getElementById('promptForm').classList.add('show');
        }

        function cancelPromptForm() {
            showPromptListView();
        }

        async function loadPrompts() {
            try {
                const response = await fetch('/api/prompts');
                const data = await response.json();
                
                if (data.success) {
                    currentPrompts = data.prompts;
                    displayPrompts();
                }
            } catch (error) {
                console.error('ÌîÑÎ°¨ÌîÑÌä∏ Î°úÎìú Ïã§Ìå®:', error);
                currentPrompts = [];
                displayPrompts();
            }
        }

        function displayPrompts() {
            const promptList = document.getElementById('promptList');
            
            if (currentPrompts.length === 0) {
                promptList.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">Ï†ÄÏû•Îêú AI ÌîÑÎ°¨ÌîÑÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            promptList.innerHTML = currentPrompts.map(prompt => `
                <div class="prompt-item" onclick="selectPrompt('${prompt.id}')">
                    <div class="prompt-item-title">${prompt.title}</div>
                    <div class="prompt-item-content">${prompt.content}</div>
                    <div style="margin-top: 10px;">
                        <button type="button" class="prompt-btn" onclick="event.stopPropagation(); editPrompt(${JSON.stringify(prompt).replace(/"/g, '&quot;')})" style="margin-right: 10px; padding: 4px 8px; font-size: 12px;">ÏàòÏ†ï</button>
                        <button type="button" class="prompt-btn" onclick="event.stopPropagation(); deletePrompt('${prompt.id}')" style="background: #dc3545; padding: 4px 8px; font-size: 12px;">ÏÇ≠Ï†ú</button>
                    </div>
                </div>
            `).join('');
        }

        function selectPrompt(promptId) {
            const prompt = currentPrompts.find(p => p.id === promptId);
            if (prompt) {
                document.getElementById('aiPrompt').value = prompt.content;
                closePromptModal();
            }
        }

        async function deletePrompt(promptId) {
            if (!confirm('Ïù¥ ÌîÑÎ°¨ÌîÑÌä∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/prompts/${promptId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    await loadPrompts();
                } else {
                    alert('ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            } catch (error) {
                console.error('ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                alert('ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        }

        // ÌîÑÎ°¨ÌîÑÌä∏ Ìèº Ï†úÏ∂ú Ï≤òÎ¶¨
        document.getElementById('promptFormElement').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            const isEdit = !!data.promptId;
            const url = isEdit ? `/api/prompts/${data.promptId}` : '/api/prompts';
            const method = isEdit ? 'PUT' : 'POST';
            
            try {
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: data.title,
                        content: data.content
                    })
                });
                
                const responseData = await response.json();
                
                if (responseData.success) {
                    await loadPrompts();
                    showPromptListView();
                } else {
                    alert(responseData.error || 'Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            } catch (error) {
                console.error('Ï†ÄÏû• Ïã§Ìå®:', error);
                alert('Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        });

        // Î°úÍ∑∏Ïù∏ Í¥ÄÎ†® Ìï®ÏàòÎì§
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateLoginUI();
            }
        }

        function updateLoginUI() {
            const loginArea = document.getElementById('loginArea');
            
            if (currentUser) {
                loginArea.innerHTML = `
                    <span class="user-info">üë§ ${currentUser.id}Îãò</span>
                    <button class="logout-btn" onclick="logout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
                    <button class="settings-btn" id="settingsBtn" onclick="showSettingsModal()" title="ÏÑ§Ï†ï">‚öôÔ∏è</button>
                `;
            } else {
                loginArea.innerHTML = `
                    <button class="login-btn" onclick="showLoginModal()">üë§ Î°úÍ∑∏Ïù∏</button>
                    <button class="settings-btn" id="settingsBtn" onclick="showSettingsModal()" title="ÏÑ§Ï†ï">‚öôÔ∏è</button>
                `;
            }
        }

        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('loginForm').reset();
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateLoginUI();
        }

        async function initializeDefaultUsers() {
            try {
                await fetch('/api/init-users', {
                    method: 'POST'
                });
                console.log('Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
            } catch (error) {
                console.error('Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
            }
        }

        // Î°úÍ∑∏Ïù∏ Ìèº Ï†úÏ∂ú Ï≤òÎ¶¨
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Î™ÖÏãúÏ†ÅÏúºÎ°ú idÏôÄ passwordÎßå ÏàòÏßë
            const id = document.getElementById('loginId').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!id || !password) {
                alert('ÏïÑÏù¥ÎîîÏôÄ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const data = {
                id: id,
                password: password
            };
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentUser = result.user;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    updateLoginUI();
                    closeLoginModal();
                    alert(`${currentUser.id}Îãò, ÌôòÏòÅÌï©ÎãàÎã§!`);
                } else {
                    alert(result.error || 'Î°úÍ∑∏Ïù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            } catch (error) {
                console.error('Î°úÍ∑∏Ïù∏ Ïò§Î•ò:', error);
                alert('Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        });

        // Í∞ÄÏ†∏Ïò® Î∏îÎ°úÍ∑∏ Í∏Ä Ï†ÄÏû• Î≥ÄÏàò
        let fetchedBlogPosts = [];

        // ÏßÅÏ†ë URLÏóêÏÑú Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞ Ìï®Ïàò
        async function fetchFromDirectUrl() {
            if (!currentUser) {
                alert('Î°úÍ∑∏Ïù∏ÏùÑ Ìïú ÌõÑÏóê ÏÇ¨Ïö©ÌïòÏã≠ÏãúÏò§');
                return;
            }

            const urlInput = document.getElementById('directUrlInput');
            const url = urlInput.value.trim();
            
            if (!url) {
                alert('URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            // ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ URL ÌòïÏãù Í≤ÄÏ¶ù
            if (!url.includes('blog.naver.com') && !url.includes('m.blog.naver.com')) {
                alert('ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ URLÎßå ÏßÄÏõêÎê©ÎãàÎã§.');
                return;
            }

            const fetchBtn = document.querySelector('.url-fetch-btn');
            const resultContent = document.getElementById('resultContent');
            const resultContainer = document.getElementById('result');

            // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî Î∞è Î°úÎî© ÏÉÅÌÉú
            fetchBtn.disabled = true;
            fetchBtn.innerHTML = 'üîÑ Í∞ÄÏ†∏Ïò§Îäî Ï§ë...';
            
            resultContent.innerHTML = '<div style="text-align: center; padding: 20px;">üîÑ URLÏóêÏÑú Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ Í∞ÄÏ†∏Ïò§Îäî Ï§ë...</div>';
            resultContainer.style.display = 'block';

            try {
                const response = await fetch('/api/scrape-blog-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        url: url,
                        title: 'URLÏóêÏÑú Í∞ÄÏ†∏Ïò® Í∏Ä'
                    })
                });

                const data = await response.json();

                if (data.success && data.content) {
                    // Ïä§ÌÅ¨Îû©ÎêúÍ∏Ä ÏÑπÏÖòÏóê ÏßÅÏ†ë ÌëúÏãú
                    const formattedContent = formatTextWithLineBreaks(data.content);
                    resultContent.innerHTML = formattedContent;
                    
                    // AI ÏÉùÏÑ± Î≤ÑÌäºÎì§ ÌëúÏãú
                    const aiGenerateBtn = document.getElementById('aiGenerateBtn');
                    const geminiGenerateBtn = document.getElementById('geminiGenerateBtn');
                    const aiPromptSection = document.getElementById('aiPromptSection');
                    aiGenerateBtn.style.display = 'block';
                    geminiGenerateBtn.style.display = 'block';
                    aiPromptSection.style.display = 'block';
                    
                    // URL ÏûÖÎ†•Ï∞Ω Ï¥àÍ∏∞Ìôî
                    urlInput.value = '';
                    
                    console.log('[INFO] ÏßÅÏ†ë URLÏóêÏÑú Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞ ÏôÑÎ£å:', data.message || '');
                    console.log(`[INFO] Í∞ÄÏ†∏Ïò® Í∏Ä Í∏∏Ïù¥: ${data.content.length}Ïûê, ÏÜåÏä§: ${data.source}`);
                } else {
                    throw new Error(data.error || 'Ïª®ÌÖêÏ∏†Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                }
            } catch (error) {
                console.error('ÏßÅÏ†ë URL Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞ Ïò§Î•ò:', error);
                resultContent.innerHTML = '<div style="text-align: center; color: red;">ÏßÅÏ†ë URLÏóêÏÑú Í∏ÄÏùÑ Í∞ÄÏ†∏Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</div>';
            } finally {
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÏõê
                fetchBtn.disabled = false;
                fetchBtn.innerHTML = 'üîó URLÏóêÏÑú Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞';
            }
        }

        // Î∏îÎ°úÍ∑∏Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞ Ìï®Ïàò
        async function fetchBlogPosts() {
            if (!currentUser) {
                alert('Î°úÍ∑∏Ïù∏ÏùÑ Ìïú ÌõÑÏóê ÏÇ¨Ïö©ÌïòÏã≠ÏãúÏò§');
                return;
            }

            const keyword = document.getElementById('keyword').value;
            if (!keyword.trim()) {
                alert('ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const fetchBtn = document.querySelector('.fetch-blogs-btn');
            const resultsContainer = document.getElementById('blogPostsResults');
            const resultsList = document.getElementById('blogPostsList');

            // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî Î∞è Î°úÎî© ÏÉÅÌÉú
            fetchBtn.disabled = true;
            fetchBtn.innerHTML = 'üîÑ Í∞ÄÏ†∏Ïò§Îäî Ï§ë...';
            
            resultsList.innerHTML = '<div style="text-align: center; padding: 20px;">Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ Í∞ÄÏ†∏Ïò§Îäî Ï§ë...</div>';
            resultsContainer.style.display = 'block';

            try {
                const response = await fetch('/api/fetch-blog-posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ keyword: keyword })
                });

                const data = await response.json();
                
                if (data.success) {
                    fetchedBlogPosts = data.blogPosts; // Î∏îÎ°úÍ∑∏ Í∏Ä Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                    displayBlogPosts(data.blogPosts);
                } else {
                    resultsList.innerHTML = '<div style="text-align: center; color: red;">Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®: ' + data.error + '</div>';
                }
            } catch (error) {
                console.error('Î∏îÎ°úÍ∑∏Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞ Ïò§Î•ò:', error);
                resultsList.innerHTML = '<div style="text-align: center; color: red;">Î∏îÎ°úÍ∑∏Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</div>';
            } finally {
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÏõê
                fetchBtn.disabled = false;
                fetchBtn.innerHTML = 'üìÑ Î∏îÎ°úÍ∑∏Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞';
            }
        }

        function displayBlogPosts(blogPosts) {
            const resultsList = document.getElementById('blogPostsList');
            
            if (blogPosts.length === 0) {
                resultsList.innerHTML = '<div style="text-align: center; color: #666;">Í≤ÄÏÉâÎêú Î∏îÎ°úÍ∑∏ Í∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
                document.getElementById('blogSelectionButtons').style.display = 'none';
                return;
            }

            let html = '';
            blogPosts.forEach((post, index) => {
                html += `
                    <div class="blog-post-item">
                        <div class="blog-post-header">
                            <input type="radio" name="selectedBlog" value="${index}" id="blog_${index}" ${index === 0 ? 'checked' : ''}>
                            <label for="blog_${index}" class="blog-post-title">${index + 1}. ${post.title}</label>
                        </div>
                        <div class="blog-post-content">${post.content}</div>
                        <a href="${post.link}" target="_blank" class="blog-post-link">ÏõêÎ¨∏ Î≥¥Í∏∞ ‚Üí</a>
                    </div>
                `;
            });
            
            resultsList.innerHTML = html;
            
            // Î∏îÎ°úÍ∑∏ ÏÑ†ÌÉù Î≤ÑÌäºÎì§ ÌëúÏãú
            if (blogPosts.length > 0) {
                const blogSelectionButtons = document.getElementById('blogSelectionButtons');
                blogSelectionButtons.style.display = 'block';
            }
        }

        async function scrapeSelectedBlog() {
            // ÏÑ†ÌÉùÎêú ÎùºÎîîÏò§ Î≤ÑÌäº Ï∞æÍ∏∞
            const selectedRadio = document.querySelector('input[name="selectedBlog"]:checked');
            if (!selectedRadio) {
                alert('Î®ºÏ†Ä Í∞ÄÏ†∏Ïò¨ Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const index = parseInt(selectedRadio.value);
            
            if (fetchedBlogPosts.length === 0) {
                alert('Î®ºÏ†Ä Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ Í∞ÄÏ†∏ÏôÄÏ£ºÏÑ∏Ïöî.');
                return;
            }

            if (index >= fetchedBlogPosts.length) {
                alert(`ÏÑ†ÌÉùÎêú Î∏îÎ°úÍ∑∏Í∞Ä ÏóÜÏäµÎãàÎã§. Ï¥ù ${fetchedBlogPosts.length}Í∞úÏùò Î∏îÎ°úÍ∑∏Í∞Ä ÏûàÏäµÎãàÎã§.`);
                return;
            }
            
            const selectedPost = fetchedBlogPosts[index];
            const resultContent = document.getElementById('resultContent');
            const result = document.getElementById('result');

            // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            const button = document.querySelector('.blog-select-btn');
            button.disabled = true;
            button.innerHTML = 'üîÑ Í∞ÄÏ†∏Ïò§Îäî Ï§ë...';
            
            // Î°úÎî© ÌëúÏãú
            resultContent.textContent = `ÏÑ†ÌÉùÎêú Í∏ÄÏùò ÏõêÎ¨∏ÏùÑ Í∞ÄÏ†∏Ïò§Îäî Ï§ëÏûÖÎãàÎã§...`;
            result.style.display = 'block';

            try {
                // Î®ºÏ†Ä ÏõêÎ¨∏ Ïä§ÌÅ¨ÎûòÌïë ÏãúÎèÑ
                const scrapingResponse = await fetch('/api/scrape-blog-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        url: selectedPost.link,
                        title: selectedPost.title
                    })
                });
                
                const scrapingData = await scrapingResponse.json();
                
                // Ïä§ÌÅ¨ÎûòÌïëÏù¥ ÏÑ±Í≥µÌïòÍ≥† Ï∂©Î∂ÑÌïú ÏΩòÌÖêÏ∏†Í∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©
                if (scrapingData.success && scrapingData.source === 'direct_scraping' && scrapingData.length > 200) {
                    // Ï†úÎ™©Í≥º Î≥∏Î¨∏ÏùÑ Ìï®Íªò ÌëúÏãú
                    const fullContent = `# ${selectedPost.title}\n\n${scrapingData.content}`;
                    const formattedContent = formatTextWithLineBreaks(fullContent);
                    resultContent.textContent = formattedContent;
                    if (scrapingData.message) {
                        resultContent.textContent += `\n\n‚Äª ${scrapingData.message}`;
                    }
                } else {
                    // Ïä§ÌÅ¨ÎûòÌïë Ïã§Ìå® Ïãú ÌôïÏû• Í≤ÄÏÉâ Î∞©Ïãù ÏÇ¨Ïö©
                    console.log('[INFO] ÏõêÎ¨∏ Ïä§ÌÅ¨ÎûòÌïë Ïã§Ìå®, ÌôïÏû• Í≤ÄÏÉâ ÏÇ¨Ïö©');
                    
                    const response = await fetch('/api/fetch-full-content', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            url: selectedPost.link,
                            title: selectedPost.title
                        })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        // Ï†úÎ™©Í≥º Î≥∏Î¨∏ÏùÑ Ìï®Íªò ÌëúÏãú
                        const fullContent = `# ${selectedPost.title}\n\n${data.content}`;
                        const formattedContent = formatTextWithLineBreaks(fullContent);
                        resultContent.textContent = formattedContent;
                        if (data.message) {
                            resultContent.textContent += `\n\n‚Äª ${data.message}`;
                        }
                    } else {
                        // Ïã§Ìå® Ïãú Í∏∞Ï°¥ ÏöîÏïΩÎ≥∏Ïóê Ï†úÎ™© Ï∂îÍ∞Ä
                        const fullContent = `# ${selectedPost.title}\n\n${selectedPost.content}`;
                        const formattedSummary = formatTextWithLineBreaks(fullContent);
                        resultContent.textContent = `ÏÑ†ÌÉùÎêú Í∏Ä ÏõêÎ¨∏ Í∞ÄÏ†∏Ïò§Í∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÏöîÏïΩÎ≥∏ÏùÑ ÌëúÏãúÌï©ÎãàÎã§:\n\n${formattedSummary}`;
                    }
                }
                
                // AI ÏÉùÏÑ± Î≤ÑÌäºÎì§ ÌëúÏãú
                const aiGenerateBtn = document.getElementById('aiGenerateBtn');
                const geminiGenerateBtn = document.getElementById('geminiGenerateBtn');
                const aiPromptSection = document.getElementById('aiPromptSection');
                aiGenerateBtn.style.display = 'block';
                geminiGenerateBtn.style.display = 'block';
                aiPromptSection.style.display = 'block';
                
                // Í≤∞Í≥º ÏÑπÏÖòÏúºÎ°ú Ïä§ÌÅ¨Î°§
                result.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('ÏõêÎ¨∏ Í∞ÄÏ†∏Ïò§Í∏∞ Ïò§Î•ò:', error);
                // Ïò§Î•ò Ïãú Í∏∞Ï°¥ ÏöîÏïΩÎ≥∏Ïóê Ï†úÎ™© Ï∂îÍ∞Ä
                const fullContent = `# ${selectedPost.title}\n\n${selectedPost.content}`;
                const formattedErrorSummary = formatTextWithLineBreaks(fullContent);
                resultContent.textContent = `ÏÑ†ÌÉùÎêú Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. ÏöîÏïΩÎ≥∏ÏùÑ ÌëúÏãúÌï©ÎãàÎã§:\n\n${formattedErrorSummary}`;
            } finally {
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÏõê
                button.disabled = false;
                button.innerHTML = 'üìÑ ÏÑ†ÌÉùÎêúÎÇ¥Ïö© Í∞ÄÏ†∏Ïò§Í∏∞';
            }
        }

        // Î¨∏Ïû• ÎÅùÏóê Ï§ÑÎ∞îÍøà Ï∂îÍ∞Ä Ìï®Ïàò
        function formatTextWithLineBreaks(text) {
            if (!text) return text;
            
            // ÌïúÍµ≠Ïñ¥ Î¨∏Ïû• ÎÅù Ìå®ÌÑ¥Îì§
            const sentenceEndings = [
                /Îã§\./g,      // Îã§.
                /Îã§\s/g,      // Îã§ (Í≥µÎ∞±)
                /ÏûÑ\./g,      // ÏûÑ.
                /ÏûÑ\s/g,      // ÏûÑ (Í≥µÎ∞±)
                /Ïñ¥\./g,      // Ïñ¥.
                /Ïñ¥\s/g,      // Ïñ¥ (Í≥µÎ∞±)
                /Ïöî\./g,      // Ïöî.
                /Ïöî\s/g,      // Ïöî (Í≥µÎ∞±)
                /Ïùå\./g,      // Ïùå.
                /Ïùå\s/g,      // Ïùå (Í≥µÎ∞±)
                /Ï£†\./g,      // Ï£†.
                /Ï£†\s/g,      // Ï£† (Í≥µÎ∞±)
                /ÎÑ§\./g,      // ÎÑ§.
                /ÎÑ§\s/g,      // ÎÑ§ (Í≥µÎ∞±)
                /Í≤å\./g,      // Í≤å.
                /Í≤å\s/g,      // Í≤å (Í≥µÎ∞±)
                /ÏßÄ\./g,      // ÏßÄ.
                /ÏßÄ\s/g,      // ÏßÄ (Í≥µÎ∞±)
                /Îãà\./g,      // Îãà.
                /Îãà\s/g,      // Îãà (Í≥µÎ∞±)
                /Íπå\./g,      // Íπå.
                /Íπå\s/g,      // Íπå (Í≥µÎ∞±)
                /Ïïº\./g,      // Ïïº.
                /Ïïº\s/g,      // Ïïº (Í≥µÎ∞±)
                /ÏïÑ\./g,      // ÏïÑ.
                /ÏïÑ\s/g,      // ÏïÑ (Í≥µÎ∞±)
                /!\s/g,       // ! (ÎäêÎÇåÌëú)
                /\?\s/g,      // ? (Î¨ºÏùåÌëú)
                /\.\.\.\s/g   // ... (ÎßêÏ§ÑÏûÑÌëú)
            ];
            
            let formattedText = text;
            
            // Í∞Å Î¨∏Ïû• ÎÅù Ìå®ÌÑ¥Ïóê ÎåÄÌï¥ Ï§ÑÎ∞îÍøà Ï∂îÍ∞Ä
            sentenceEndings.forEach(pattern => {
                formattedText = formattedText.replace(pattern, (match) => {
                    // ÎßàÏßÄÎßâ Î¨∏ÏûêÍ∞Ä Í≥µÎ∞±Ïù¥Î©¥ Ï†úÍ±∞ÌïòÍ≥† Ï§ÑÎ∞îÍøà Ï∂îÍ∞Ä
                    const trimmedMatch = match.trim();
                    return trimmedMatch + '\n\n';
                });
            });
            
            // Ïó∞ÏÜçÎêú Ï§ÑÎ∞îÍøà Ï†ïÎ¶¨ (3Í∞ú Ïù¥ÏÉÅÏùò Ï§ÑÎ∞îÍøàÏùÑ 2Í∞úÎ°ú)
            formattedText = formattedText.replace(/\n{3,}/g, '\n\n');
            
            // ÏïûÎí§ Í≥µÎ∞± Ï†úÍ±∞
            formattedText = formattedText.trim();
            
            return formattedText;
        }

        // Í∞úÎ≥Ñ Î∏îÎ°úÍ∑∏ Ïä§ÌÅ¨ÎûòÌïë Ìï®Ïàò
        async function scrapeBlogPost(index) {
            if (fetchedBlogPosts.length === 0) {
                alert('Î®ºÏ†Ä Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ Í∞ÄÏ†∏ÏôÄÏ£ºÏÑ∏Ïöî.');
                return;
            }

            if (index >= fetchedBlogPosts.length) {
                alert(`${index + 1}Î≤àÏß∏ Î∏îÎ°úÍ∑∏Í∞Ä ÏóÜÏäµÎãàÎã§. Ï¥ù ${fetchedBlogPosts.length}Í∞úÏùò Î∏îÎ°úÍ∑∏Í∞Ä ÏûàÏäµÎãàÎã§.`);
                return;
            }
            
            const selectedPost = fetchedBlogPosts[index];
            const resultContent = document.getElementById('resultContent');
            const result = document.getElementById('result');

            // Î™®Îì† Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            const buttons = document.querySelectorAll('.blog-select-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
            });
            
            // Î°úÎî© ÌëúÏãú
            resultContent.textContent = `${index + 1}Î≤àÏß∏ Í∏ÄÏùò ÏõêÎ¨∏ÏùÑ Í∞ÄÏ†∏Ïò§Îäî Ï§ëÏûÖÎãàÎã§...`;
            result.style.display = 'block';

            try {
                // Î®ºÏ†Ä ÏõêÎ¨∏ Ïä§ÌÅ¨ÎûòÌïë ÏãúÎèÑ
                const scrapingResponse = await fetch('/api/scrape-blog-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        url: selectedPost.link,
                        title: selectedPost.title
                    })
                });
                
                const scrapingData = await scrapingResponse.json();
                
                // Ïä§ÌÅ¨ÎûòÌïëÏù¥ ÏÑ±Í≥µÌïòÍ≥† Ï∂©Î∂ÑÌïú ÏΩòÌÖêÏ∏†Í∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©
                if (scrapingData.success && scrapingData.source === 'direct_scraping' && scrapingData.length > 200) {
                    // Î¨∏Ïû• ÎÅùÏóê Ï§ÑÎ∞îÍøàÏùÑ Ï∂îÍ∞ÄÌïòÏó¨ ÌëúÏãú
                    const formattedContent = formatTextWithLineBreaks(scrapingData.content);
                    resultContent.textContent = formattedContent;
                    if (scrapingData.message) {
                        resultContent.textContent += `\n\n‚Äª ${scrapingData.message}`;
                    }
                } else {
                    // Ïä§ÌÅ¨ÎûòÌïë Ïã§Ìå® Ïãú ÌôïÏû• Í≤ÄÏÉâ Î∞©Ïãù ÏÇ¨Ïö©
                    console.log('[INFO] ÏõêÎ¨∏ Ïä§ÌÅ¨ÎûòÌïë Ïã§Ìå®, ÌôïÏû• Í≤ÄÏÉâ ÏÇ¨Ïö©');
                    
                    const response = await fetch('/api/fetch-full-content', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            url: selectedPost.link,
                            title: selectedPost.title
                        })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        // ÌôïÏû• Í≤ÄÏÉâ Í≤∞Í≥ºÏóêÎèÑ Ï§ÑÎ∞îÍøà ÌòïÏãù Ï†ÅÏö©
                        const formattedContent = formatTextWithLineBreaks(data.content);
                        resultContent.textContent = formattedContent;
                        if (data.message) {
                            resultContent.textContent += `\n\n‚Äª ${data.message}`;
                        }
                    } else {
                        // Ïã§Ìå® Ïãú Í∏∞Ï°¥ ÏöîÏïΩÎ≥∏ÎèÑ Ï§ÑÎ∞îÍøà ÌòïÏãù Ï†ÅÏö©
                        const formattedSummary = formatTextWithLineBreaks(selectedPost.content);
                        resultContent.textContent = `${index + 1}Î≤àÏß∏ Í∏Ä ÏõêÎ¨∏ Í∞ÄÏ†∏Ïò§Í∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÏöîÏïΩÎ≥∏ÏùÑ ÌëúÏãúÌï©ÎãàÎã§:\n\n${formattedSummary}`;
                    }
                }
                
                // AI ÏÉùÏÑ± Î≤ÑÌäºÎì§ ÌëúÏãú
                const aiGenerateBtn = document.getElementById('aiGenerateBtn');
                const geminiGenerateBtn = document.getElementById('geminiGenerateBtn');
                const aiPromptSection = document.getElementById('aiPromptSection');
                aiGenerateBtn.style.display = 'block';
                geminiGenerateBtn.style.display = 'block';
                aiPromptSection.style.display = 'block';
                
                // Í≤∞Í≥º ÏÑπÏÖòÏúºÎ°ú Ïä§ÌÅ¨Î°§
                result.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('ÏõêÎ¨∏ Í∞ÄÏ†∏Ïò§Í∏∞ Ïò§Î•ò:', error);
                // Ïò§Î•ò Ïãú Í∏∞Ï°¥ ÏöîÏïΩÎ≥∏ÎèÑ Ï§ÑÎ∞îÍøà ÌòïÏãù Ï†ÅÏö©
                const formattedErrorSummary = formatTextWithLineBreaks(selectedPost.content);
                resultContent.textContent = `${index + 1}Î≤àÏß∏ Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. ÏöîÏïΩÎ≥∏ÏùÑ ÌëúÏãúÌï©ÎãàÎã§:\n\n${formattedErrorSummary}`;
            } finally {
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÏõê
                const buttons = document.querySelectorAll('.blog-select-btn');
                buttons.forEach((btn, btnIndex) => {
                    btn.disabled = false;
                    // Í∞Å Î≤ÑÌäºÏùò ÏõêÎûò ÌÖçÏä§Ìä∏ Î≥µÏõê
                    const buttonTexts = [
                        'üìù Ï≤´Î≤àÏß∏ÎÇ¥Ïö©Í∞ÄÏ†∏Ïò§Í∏∞',
                        'üìÑ ÎëêÎ≤àÏß∏ÎÇ¥Ïö©Í∞ÄÏ†∏Ïò§Í∏∞', 
                        'üìã ÏÑ∏Î≤àÏß∏ÎÇ¥Ïö©Í∞ÄÏ†∏Ïò§Í∏∞',
                        'üìö Ï≤òÏùå3Í∞úÎ™®ÎëêÍ∞ÄÏ†∏Ïò§Í∏∞'
                    ];
                    if (btnIndex < buttonTexts.length) {
                        btn.innerHTML = buttonTexts[btnIndex];
                    }
                });
            }
        }
        
        // Ïó¨Îü¨ Î∏îÎ°úÍ∑∏ ÎèôÏãú Ïä§ÌÅ¨ÎûòÌïë Ìï®Ïàò
        async function scrapeMultipleBlogs() {
            if (fetchedBlogPosts.length === 0) {
                alert('Î®ºÏ†Ä Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ Í∞ÄÏ†∏ÏôÄÏ£ºÏÑ∏Ïöî.');
                return;
            }
            
            const resultContent = document.getElementById('resultContent');
            const result = document.getElementById('result');
            
            // ÏµúÎåÄ 3Í∞ú ÎòêÎäî ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î∏îÎ°úÍ∑∏ ÏàòÎßåÌÅº
            const blogsToScrape = Math.min(3, fetchedBlogPosts.length);
            
            // Î™®Îì† Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            const buttons = document.querySelectorAll('.blog-select-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
            });
            
            // ÎßàÏßÄÎßâ Î≤ÑÌäºÏùÑ Î°úÎî© ÏÉÅÌÉúÎ°ú
            const allBlogsBtn = buttons[buttons.length - 1];
            allBlogsBtn.innerHTML = 'üîÑ Î™®Îëê Í∞ÄÏ†∏Ïò§Îäî Ï§ë...';
            
            // Î°úÎî© ÌëúÏãú
            resultContent.textContent = `Ï≤òÏùå ${blogsToScrape}Í∞ú Î∏îÎ°úÍ∑∏Ïùò ÏõêÎ¨∏ÏùÑ Í∞ÄÏ†∏Ïò§Îäî Ï§ëÏûÖÎãàÎã§...`;
            result.style.display = 'block';
            
            try {
                let combinedContent = '';
                let successCount = 0;
                
                for (let i = 0; i < blogsToScrape; i++) {
                    const currentPost = fetchedBlogPosts[i];
                    resultContent.textContent = `${i + 1}Î≤àÏß∏ Î∏îÎ°úÍ∑∏ Í∞ÄÏ†∏Ïò§Îäî Ï§ë... (${i + 1}/${blogsToScrape})`;
                    
                    try {
                        // ÏõêÎ¨∏ Ïä§ÌÅ¨ÎûòÌïë ÏãúÎèÑ
                        const scrapingResponse = await fetch('/api/scrape-blog-content', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ 
                                url: currentPost.link,
                                title: currentPost.title
                            })
                        });
                        
                        const scrapingData = await scrapingResponse.json();
                        
                        let blogContent = '';
                        
                        if (scrapingData.success && scrapingData.source === 'direct_scraping' && scrapingData.length > 200) {
                            blogContent = formatTextWithLineBreaks(scrapingData.content);
                            successCount++;
                        } else {
                            // Ïä§ÌÅ¨ÎûòÌïë Ïã§Ìå® Ïãú ÌôïÏû• Í≤ÄÏÉâ ÏãúÎèÑ
                            try {
                                const response = await fetch('/api/fetch-full-content', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({ 
                                        url: currentPost.link,
                                        title: currentPost.title
                                    })
                                });
                                
                                const data = await response.json();
                                
                                if (data.success) {
                                    blogContent = formatTextWithLineBreaks(data.content);
                                    successCount++;
                                } else {
                                    // ÎåÄÏ≤¥ ÏöîÏïΩÎ≥∏ ÏÇ¨Ïö©
                                    blogContent = formatTextWithLineBreaks(currentPost.content);
                                }
                            } catch (error) {
                                blogContent = formatTextWithLineBreaks(currentPost.content);
                            }
                        }
                        
                        // Í∞Å Î∏îÎ°úÍ∑∏ ÎÇ¥Ïö©ÏùÑ Íµ¨Î∂ÑÏûêÏôÄ Ìï®Íªò Ï∂îÍ∞Ä
                        combinedContent += `\n\n=== ${i + 1}Î≤àÏß∏ Î∏îÎ°úÍ∑∏: ${currentPost.title.replace(/<[^>]*>/g, '')} ===\n\n`;
                        combinedContent += blogContent + '\n\n';
                        
                    } catch (error) {
                        console.error(`${i + 1}Î≤àÏß∏ Î∏îÎ°úÍ∑∏ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®:`, error);
                        // Ïã§Ìå®Ìïú Í≤ΩÏö∞ ÏöîÏïΩÎ≥∏ÏúºÎ°ú ÎåÄÏ≤¥
                        combinedContent += `\n\n=== ${i + 1}Î≤àÏß∏ Î∏îÎ°úÍ∑∏: ${currentPost.title.replace(/<[^>]*>/g, '')} (ÏöîÏïΩÎ≥∏) ===\n\n`;
                        combinedContent += formatTextWithLineBreaks(currentPost.content) + '\n\n';
                    }
                }
                
                // ÏµúÏ¢Ö Í≤∞Í≥º ÌëúÏãú
                const finalContent = `Ï≤òÏùå ${blogsToScrape}Í∞ú Î∏îÎ°úÍ∑∏ ÎÇ¥Ïö© (ÏõêÎ¨∏ ${successCount}Í∞ú, ÏöîÏïΩ ${blogsToScrape - successCount}Í∞ú)\n` + combinedContent.trim();
                resultContent.textContent = finalContent;
                
                // AI ÏÉùÏÑ± Î≤ÑÌäºÎì§ ÌëúÏãú
                const aiGenerateBtn = document.getElementById('aiGenerateBtn');
                const geminiGenerateBtn = document.getElementById('geminiGenerateBtn');
                const aiPromptSection = document.getElementById('aiPromptSection');
                aiGenerateBtn.style.display = 'block';
                geminiGenerateBtn.style.display = 'block';
                aiPromptSection.style.display = 'block';
                
                // Í≤∞Í≥º ÏÑπÏÖòÏúºÎ°ú Ïä§ÌÅ¨Î°§
                result.scrollIntoView({ behavior: 'smooth' });
                
                console.log(`[INFO] Îã§Ï§ë Î∏îÎ°úÍ∑∏ Ïä§ÌÅ¨ÎûòÌïë ÏôÑÎ£å: ${successCount}/${blogsToScrape} ÏÑ±Í≥µ`);
                
            } catch (error) {
                console.error('Îã§Ï§ë Î∏îÎ°úÍ∑∏ Í∞ÄÏ†∏Ïò§Í∏∞ Ïò§Î•ò:', error);
                resultContent.textContent = `Îã§Ï§ë Î∏îÎ°úÍ∑∏ Í∞ÄÏ†∏Ïò§Í∏∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}`;
            } finally {
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÏõê
                const buttons = document.querySelectorAll('.blog-select-btn');
                buttons.forEach((btn, btnIndex) => {
                    btn.disabled = false;
                    const buttonTexts = [
                        'üìù Ï≤´Î≤àÏß∏ÎÇ¥Ïö©Í∞ÄÏ†∏Ïò§Í∏∞',
                        'üìÑ ÎëêÎ≤àÏß∏ÎÇ¥Ïö©Í∞ÄÏ†∏Ïò§Í∏∞', 
                        'üìã ÏÑ∏Î≤àÏß∏ÎÇ¥Ïö©Í∞ÄÏ†∏Ïò§Í∏∞',
                        'üìö Ï≤òÏùå3Í∞úÎ™®ÎëêÍ∞ÄÏ†∏Ïò§Í∏∞'
                    ];
                    if (btnIndex < buttonTexts.length) {
                        btn.innerHTML = buttonTexts[btnIndex];
                    }
                });
            }
        }

        function getCompetitionText(competition) {
            switch(competition) {
                case 'low': return 'ÎÇÆÏùå';
                case 'medium': return 'Ï§ëÍ∞Ñ';
                case 'high': return 'ÎÜíÏùå';
                default: return 'Ï§ëÍ∞Ñ';
            }
        }

        let selectedKeywordForChoice = '';

        function selectKeyword(keyword) {
            // ÏÑ†ÌÉùÎêú ÌÇ§ÏõåÎìúÎ•º Ï†ÄÏû•ÌïòÍ≥† Î™®Îã¨Ï∞Ω ÌëúÏãú
            selectedKeywordForChoice = keyword;
            document.getElementById('selectedKeywordText').textContent = keyword;
            document.getElementById('keywordChoiceModal').style.display = 'block';
        }

        function closeKeywordChoiceModal() {
            document.getElementById('keywordChoiceModal').style.display = 'none';
            selectedKeywordForChoice = '';
        }

        function applyToMainSearch() {
            if (selectedKeywordForChoice) {
                // Î≥∏Î¨∏ Í≤ÄÏÉâÌÇ§ÏõåÎìúÏ∞ΩÏóê ÏûÖÎ†•ÌïòÍ≥† Î∏îÎ°úÍ∑∏ Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìñâ
                document.getElementById('keyword').value = selectedKeywordForChoice;
                closeKeywordChoiceModal();
                // ÌÇ§ÏõåÎìúÎ∞úÍµ¥ ÌôîÎ©¥ÏóêÏÑú Î©îÏù∏ÏúºÎ°ú Ïù¥Îèô
                if (document.getElementById('keywordDiscoveryPage').style.display === 'block') {
                    hideKeywordDiscovery();
                }
                // ÏûêÎèôÏúºÎ°ú Î∏îÎ°úÍ∑∏ Í∏Ä Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìñâ
                setTimeout(() => {
                    fetchBlogs();
                }, 300);
            }
        }

        function applyToKeywordDiscovery() {
            if (selectedKeywordForChoice) {
                // ÌÇ§ÏõåÎìúÎ∞úÍµ¥ ÏûÖÎ†•Ï∞ΩÏóê ÏûÖÎ†•ÌïòÍ≥† ÌÇ§ÏõåÎìú Î∞úÍµ¥ Ïû¨Ïã§Ìñâ
                document.getElementById('keywordDiscoveryInput').value = selectedKeywordForChoice;
                closeKeywordChoiceModal();
                // ÏûêÎèôÏúºÎ°ú ÌÇ§ÏõåÎìú Î∞úÍµ¥ Ïã§Ìñâ
                setTimeout(() => {
                    startKeywordDiscovery();
                }, 300);
            }
        }
        
        // AIÎ°ú Í∏ÄÏÉùÏÑ±ÌïòÍ∏∞ Ìï®Ïàò (Ïä§ÌÅ¨Îû©Îêú Í∏Ä Í∏∞Î∞ò)
        async function generateAIContent() {
            const aiGenerateBtn = document.getElementById('aiGenerateBtn');
            const aiResult = document.getElementById('aiResult');
            const aiResultContent = document.getElementById('aiResultContent');
            const resultContent = document.getElementById('resultContent');
            
            if (!resultContent.textContent) {
                alert('Î®ºÏ†Ä Ïä§ÌÅ¨Îû©Îêú Í∏ÄÏù¥ ÏûàÏñ¥Ïïº AIÎ°ú Í∏ÄÏùÑ ÏÉùÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§.');
                return;
            }
            
            // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî Î∞è Î°úÎî© ÏÉÅÌÉú
            aiGenerateBtn.disabled = true;
            aiGenerateBtn.innerHTML = 'üîÑ AIÍ∞Ä Í∏ÄÏùÑ ÏÉùÏÑ±ÌïòÎäî Ï§ë...';
            
            // AI Í≤∞Í≥º ÏÑπÏÖò ÌëúÏãú
            aiResult.style.display = 'block';
            
            // Ï≤´Î≤àÏß∏ ÏÉùÏÑ±ÎêúÍ∏Ä Í∏∞Î∞ò Ï∂îÍ∞Ä ÏÉùÏÑ± Î≤ÑÌäºÎì§ ÌëúÏãú
            const secondGenerationButtons = document.getElementById('secondGenerationButtons');
            secondGenerationButtons.style.display = 'block';
            aiResultContent.textContent = 'AIÍ∞Ä Ïä§ÌÅ¨Îû©Îêú Í∏ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú ÏÉàÎ°úÏö¥ Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ ÏÉùÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§...';
            
            try {
                // ÌòÑÏû¨ ÌÇ§ÏõåÎìú Í∞ÄÏ†∏Ïò§Í∏∞
                const keyword = document.getElementById('keyword').value.trim();
                
                // AI ÌîÑÎ°¨ÌîÑÌä∏ Í∞ÄÏ†∏Ïò§Í∏∞ (ÎπÑÏñ¥ÏûàÏñ¥ÎèÑ Îê®)
                const aiPromptTextarea = document.getElementById('aiPrompt');
                const aiPrompt = aiPromptTextarea ? aiPromptTextarea.value.trim() : '';
                
                // Ïä§ÌÅ¨Îû©Îêú Í∏Ä ÎÇ¥Ïö© Í∞ÄÏ†∏Ïò§Í∏∞
                let scrapedContent = resultContent.textContent;
                
                // ÌÖçÏä§Ìä∏ ÎåÄÏ≤¥ Í∏∞Îä•
                const replaceText = document.getElementById('replaceText').value.trim();
                const newText = document.getElementById('newText').value.trim();
                
                if (replaceText && newText) {
                    const originalLength = scrapedContent.length;
                    scrapedContent = scrapedContent.replace(new RegExp(replaceText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi'), newText);
                    console.log(`[DEBUG] ÌÖçÏä§Ìä∏ ÎåÄÏ≤¥: "${replaceText}" ‚Üí "${newText}"`);
                    console.log(`[DEBUG] ÎåÄÏ≤¥ ÌõÑ Í∏Ä Í∏∏Ïù¥ Î≥ÄÌôî: ${originalLength}Ïûê ‚Üí ${scrapedContent.length}Ïûê`);
                }
                
                console.log(`[DEBUG] ÏµúÏ¢Ö Ïä§ÌÅ¨Îû©Îêú Í∏Ä Í∏∏Ïù¥: ${scrapedContent.length}Ïûê`);
                console.log(`[DEBUG] AI ÌîÑÎ°¨ÌîÑÌä∏: ${aiPrompt || '(ÎπÑÏñ¥ÏûàÏùå - 30% Î≥ÄÍ≤Ω Î™®Îìú)'}`);
                
                // ÏÑúÎ≤ÑÏóê Ïä§ÌÅ¨Îû© Í∏∞Î∞ò AI Í∏Ä ÏÉùÏÑ± ÏöîÏ≤≠
                const response = await fetch('/api/generate-ai-from-scraped', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        scrapedContent: scrapedContent,
                        aiPrompt: aiPrompt,
                        keyword: keyword
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // AI ÏÉùÏÑ± Í∏Ä ÌëúÏãú
                    aiResultContent.textContent = data.content;
                    
                    // Í≤∞Í≥º Î©îÏãúÏßÄ Ï∂îÍ∞Ä
                    if (data.message) {
                        aiResultContent.textContent += `\n\n‚Äª ${data.message}`;
                    }
                    
                    // ÎπÑÍµê Î≤ÑÌäº ÌëúÏãú
                    const compareBtn = document.getElementById('compareBtn');
                    compareBtn.style.display = 'block';
                    
                    // AI Í≤∞Í≥º ÏÑπÏÖòÏúºÎ°ú Ïä§ÌÅ¨Î°§
                    aiResult.scrollIntoView({ behavior: 'smooth' });
                    
                    console.log(`[INFO] AI ÏÉùÏÑ± ÏôÑÎ£å: ${data.generatedLength}Ïûê (ÏõêÎ≥∏: ${data.originalLength}Ïûê)`);
                } else {
                    throw new Error(data.error || 'AI Í∏Ä ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
                
            } catch (error) {
                console.error('AI Í∏Ä ÏÉùÏÑ± Ïò§Î•ò:', error);
                aiResultContent.textContent = `AI Í∏Ä ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ${error.message}`;
            } finally {
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÏõê
                aiGenerateBtn.disabled = false;
                aiGenerateBtn.innerHTML = 'ü§ñ ClaudeÎ°ú Í∏ÄÏÉùÏÑ±ÌïòÍ∏∞';
            }
        }

        // GeminiÎ°ú Í∏ÄÏÉùÏÑ±ÌïòÍ∏∞ Ìï®Ïàò
        async function generateGeminiContent() {
            const geminiGenerateBtn = document.getElementById('geminiGenerateBtn');
            const aiResult = document.getElementById('aiResult');
            const aiResultContent = document.getElementById('aiResultContent');
            const resultContent = document.getElementById('resultContent');
            
            if (!resultContent.textContent) {
                alert('Î®ºÏ†Ä Ïä§ÌÅ¨Îû©Îêú Í∏ÄÏù¥ ÏûàÏñ¥Ïïº GeminiÎ°ú Í∏ÄÏùÑ ÏÉùÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§.');
                return;
            }
            
            // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî Î∞è Î°úÎî© ÏÉÅÌÉú
            geminiGenerateBtn.disabled = true;
            geminiGenerateBtn.innerHTML = 'üîÑ GeminiÍ∞Ä Í∏ÄÏùÑ ÏÉùÏÑ±ÌïòÎäî Ï§ë...';
            
            // AI Í≤∞Í≥º ÏÑπÏÖò ÌëúÏãú
            aiResult.style.display = 'block';
            
            // Ï≤´Î≤àÏß∏ ÏÉùÏÑ±ÎêúÍ∏Ä Í∏∞Î∞ò Ï∂îÍ∞Ä ÏÉùÏÑ± Î≤ÑÌäºÎì§ ÌëúÏãú
            const secondGenerationButtons = document.getElementById('secondGenerationButtons');
            secondGenerationButtons.style.display = 'block';
            aiResultContent.textContent = 'GeminiÍ∞Ä Ïä§ÌÅ¨Îû©Îêú Í∏ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú ÏÉàÎ°úÏö¥ Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ ÏÉùÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§...';
            
            try {
                // ÌòÑÏû¨ ÌÇ§ÏõåÎìú Í∞ÄÏ†∏Ïò§Í∏∞
                const keyword = document.getElementById('keyword').value.trim();
                
                // AI ÌîÑÎ°¨ÌîÑÌä∏ Í∞ÄÏ†∏Ïò§Í∏∞ (ÎπÑÏñ¥ÏûàÏñ¥ÎèÑ Îê®)
                const aiPromptTextarea = document.getElementById('aiPrompt');
                const aiPrompt = aiPromptTextarea ? aiPromptTextarea.value.trim() : '';
                
                // Ïä§ÌÅ¨Îû©Îêú Í∏Ä ÎÇ¥Ïö© Í∞ÄÏ†∏Ïò§Í∏∞
                let scrapedContent = resultContent.textContent;
                
                // ÌÖçÏä§Ìä∏ ÎåÄÏ≤¥ Í∏∞Îä•
                const replaceText = document.getElementById('replaceText').value.trim();
                const newText = document.getElementById('newText').value.trim();
                
                if (replaceText && newText) {
                    const originalLength = scrapedContent.length;
                    scrapedContent = scrapedContent.replace(new RegExp(replaceText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi'), newText);
                    console.log(`[DEBUG] Gemini ÌÖçÏä§Ìä∏ ÎåÄÏ≤¥: "${replaceText}" ‚Üí "${newText}"`);
                    console.log(`[DEBUG] Gemini ÎåÄÏ≤¥ ÌõÑ Í∏Ä Í∏∏Ïù¥ Î≥ÄÌôî: ${originalLength}Ïûê ‚Üí ${scrapedContent.length}Ïûê`);
                }
                
                console.log(`[DEBUG] Gemini ÏµúÏ¢Ö Ïä§ÌÅ¨Îû©Îêú Í∏Ä Í∏∏Ïù¥: ${scrapedContent.length}Ïûê`);
                console.log(`[DEBUG] Gemini AI ÌîÑÎ°¨ÌîÑÌä∏: ${aiPrompt || '(ÎπÑÏñ¥ÏûàÏùå - 30% Î≥ÄÍ≤Ω Î™®Îìú)'}`);
                
                // ÏÑúÎ≤ÑÏóê Gemini Í∏∞Î∞ò AI Í∏Ä ÏÉùÏÑ± ÏöîÏ≤≠
                const response = await fetch('/api/generate-gemini-from-scraped', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        scrapedContent: scrapedContent,
                        aiPrompt: aiPrompt,
                        keyword: keyword
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Gemini ÏÉùÏÑ± Í∏Ä ÌëúÏãú
                    aiResultContent.textContent = data.content;
                    
                    // Í≤∞Í≥º Î©îÏãúÏßÄ Ï∂îÍ∞Ä
                    if (data.message) {
                        aiResultContent.textContent += `\n\n‚Äª ${data.message}`;
                    }
                    
                    // ÎπÑÍµê Î≤ÑÌäº ÌëúÏãú
                    const compareBtn = document.getElementById('compareBtn');
                    compareBtn.style.display = 'block';
                    
                    console.log(`[INFO] Gemini AI Í∏Ä ÏÉùÏÑ± ÏôÑÎ£å: ${data.content.length}Ïûê`);
                    
                    // Í≤∞Í≥º ÏÑπÏÖòÏúºÎ°ú Ïä§ÌÅ¨Î°§
                    aiResult.scrollIntoView({ behavior: 'smooth' });
                } else {
                    throw new Error(data.error || 'Gemini Í∏Ä ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
                
            } catch (error) {
                console.error('Gemini Í∏Ä ÏÉùÏÑ± Ïò§Î•ò:', error);
                aiResultContent.textContent = `Gemini Í∏Ä ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ${error.message}`;
            } finally {
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÏõê
                geminiGenerateBtn.disabled = false;
                geminiGenerateBtn.innerHTML = 'üíé GeminiÎ°ú Í∏ÄÏÉùÏÑ±ÌïòÍ∏∞';
            }
        }
        
        // ÏõêÎ¨∏Í≥º ÎπÑÍµêÌïòÍ∏∞ Ìï®Ïàò
        function compareTexts() {
            const resultContent = document.getElementById('resultContent');
            const aiResultContent = document.getElementById('aiResultContent');
            const comparisonResult = document.getElementById('comparisonResult');
            const comparisonContent = document.getElementById('comparisonContent');
            
            if (!resultContent.textContent || !aiResultContent.textContent) {
                alert('Ïä§ÌÅ¨Îû©Îêú Í∏ÄÍ≥º AI ÏÉùÏÑ± Í∏ÄÏù¥ Î™®Îëê ÏûàÏñ¥Ïïº ÎπÑÍµêÌï† Ïàò ÏûàÏäµÎãàÎã§.');
                return;
            }
            
            console.log('[DEBUG] Ï†ÑÏ≤¥ Î¨∏Îß• Í∏∞Î∞ò ÎπÑÍµê ÏãúÏûë');
            
            // ÏõêÎ¨∏Í≥º AI ÏÉùÏÑ±Í∏Ä Ï†ÑÏ≤¥ ÌÖçÏä§Ìä∏
            const originalText = resultContent.textContent.trim();
            const aiText = aiResultContent.textContent
                .replace(/\n\n‚Äª.*$/, '') // Î©îÏãúÏßÄ Î∂ÄÎ∂Ñ Ï†úÍ±∞
                .trim();
            
            // AI ÌÖçÏä§Ìä∏ÏóêÏÑú ÏõêÎ¨∏Í≥º Ïú†ÏÇ¨Ìïú Î∂ÄÎ∂ÑÏùÑ Ï∞æÏïÑÏÑú Îπ®Í∞ÑÏÉâÏúºÎ°ú ÌëúÏãú
            const highlightedAiText = highlightSimilarParts(originalText, aiText);
            
            // Ï†ÑÏ≤¥ Ïú†ÏÇ¨ÎèÑ Í≥ÑÏÇ∞
            const similarity = calculateAdvancedSimilarity(originalText, aiText);
            
            // ÎπÑÍµê Í≤∞Í≥º HTML ÏÉùÏÑ±
            let comparisonHTML = `
                <div style="margin-bottom: 20px; text-align: center;">
                    <p><strong>ÏõêÎ¨∏:</strong> ${originalText.length}Ïûê</p>
                    <p><strong>AI ÏÉùÏÑ±Í∏Ä:</strong> ${aiText.length}Ïûê</p>
                    <p><strong>Ï†ÑÏ≤¥ Î¨∏Îß• Ïú†ÏÇ¨ÎèÑ:</strong> ${similarity.toFixed(1)}%</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #333; margin-bottom: 10px;">üìÑ ÏõêÎ¨∏</h4>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; line-height: 1.8; border-left: 4px solid #6c757d;">
                        ${formatTextWithLineBreaks(originalText)}
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #dc3545; margin-bottom: 10px;">ü§ñ AI ÏÉùÏÑ±Í∏Ä (Ïú†ÏÇ¨ Î∂ÄÎ∂ÑÏùÄ <span style="color: red;">Îπ®Í∞ÑÏÉâ</span>ÏúºÎ°ú ÌëúÏãú)</h4>
                    <div style="background: #fff5f5; padding: 20px; border-radius: 8px; line-height: 1.8; border-left: 4px solid #dc3545;">
                        ${highlightedAiText}
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #e8f4fd; border-radius: 8px; text-align: center;">
                    <h4 style="margin: 0 0 10px 0; color: #1976d2;">üìä Î∂ÑÏÑù Í≤∞Í≥º</h4>
                    <p style="margin: 5px 0;"><strong>Î¨∏Îß•Ï†Å Ïú†ÏÇ¨ÎèÑ:</strong> ${similarity.toFixed(1)}%</p>
                    <p style="margin: 5px 0;"><strong>ÎèÖÏ∞ΩÏÑ±:</strong> ${(100 - similarity).toFixed(1)}%</p>
                    <p style="margin: 5px 0; font-size: 14px; color: #666;">
                        ${similarity > 80 ? 'Îß§Ïö∞ Ïú†ÏÇ¨Ìïú ÎÇ¥Ïö©' : 
                          similarity > 60 ? 'ÏÉÅÎãπÌûà Ïú†ÏÇ¨Ìïú ÎÇ¥Ïö©' : 
                          similarity > 40 ? 'Î∂ÄÎ∂ÑÏ†ÅÏúºÎ°ú Ïú†ÏÇ¨Ìïú ÎÇ¥Ïö©' : 'ÎåÄÎ∂ÄÎ∂Ñ Îã§Î•∏ ÎÇ¥Ïö©'}
                    </p>
                </div>
            `;
            
            comparisonContent.innerHTML = comparisonHTML;
            comparisonResult.style.display = 'block';
            
            // ÎπÑÍµê Í≤∞Í≥ºÎ°ú Ïä§ÌÅ¨Î°§
            comparisonResult.scrollIntoView({ behavior: 'smooth' });
            
            console.log(`[INFO] Î¨∏Îß• Í∏∞Î∞ò ÎπÑÍµê ÏôÑÎ£å: Ïú†ÏÇ¨ÎèÑ ${similarity.toFixed(1)}%`);
        }
        
        // Í≥†Í∏â Î¨∏Îß• Í∏∞Î∞ò Ïú†ÏÇ¨ÎèÑ Í≥ÑÏÇ∞ Ìï®Ïàò
        function calculateAdvancedSimilarity(text1, text2) {
            // ÌÖçÏä§Ìä∏Î•º Îã®Ïñ¥/Íµ¨Î¨∏ Îã®ÏúÑÎ°ú Î∂ÑÏÑù
            const words1 = extractWords(text1);
            const words2 = extractWords(text2);
            const phrases1 = extractPhrases(text1);
            const phrases2 = extractPhrases(text2);
            
            // Îã®Ïñ¥ Î†àÎ≤® Ïú†ÏÇ¨ÎèÑ
            const wordSimilarity = calculateWordSimilarity(words1, words2);
            
            // Íµ¨Î¨∏ Î†àÎ≤® Ïú†ÏÇ¨ÎèÑ  
            const phraseSimilarity = calculatePhraseSimilarity(phrases1, phrases2);
            
            // Ï†ÑÏ≤¥ Íµ¨Ï°∞ Ïú†ÏÇ¨ÎèÑ
            const structureSimilarity = calculateStructureSimilarity(text1, text2);
            
            // Í∞ÄÏ§ë ÌèâÍ∑†ÏúºÎ°ú ÏµúÏ¢Ö Ïú†ÏÇ¨ÎèÑ Í≥ÑÏÇ∞
            const finalSimilarity = (wordSimilarity * 0.4 + phraseSimilarity * 0.4 + structureSimilarity * 0.2);
            
            return Math.max(0, Math.min(100, finalSimilarity));
        }

        // Ïú†ÏÇ¨Ìïú Î∂ÄÎ∂ÑÏùÑ Îπ®Í∞ÑÏÉâÏúºÎ°ú ÌëúÏãúÌïòÎäî Ìï®Ïàò
        function highlightSimilarParts(originalText, aiText) {
            // AI ÌÖçÏä§Ìä∏Î•º Î¨∏Ïû• Îã®ÏúÑÎ°ú Î∂ÑÎ¶¨
            const aiSentences = aiText.split(/([.!?]|\.\s)/g).filter(s => s.trim().length > 0);
            let highlightedText = '';
            
            for (let i = 0; i < aiSentences.length; i++) {
                const sentence = aiSentences[i];
                if (sentence.match(/^[.!?]$/) || sentence.match(/^\.\s$/)) {
                    highlightedText += sentence;
                    continue;
                }
                
                // Í∞Å Î¨∏Ïû•Ïù¥ ÏõêÎ¨∏Í≥º ÏñºÎßàÎÇò Ïú†ÏÇ¨ÌïúÏßÄ ÌôïÏù∏
                const similarity = findBestMatchSimilarity(sentence, originalText);
                
                if (similarity > 30) { // 30% Ïù¥ÏÉÅ Ïú†ÏÇ¨ÌïòÎ©¥ Îπ®Í∞ÑÏÉâ ÌëúÏãú
                    highlightedText += `<span style="color: red; font-weight: 500;">${sentence}</span>`;
                } else {
                    highlightedText += sentence;
                }
            }
            
            return formatTextWithLineBreaks(highlightedText);
        }

        // Î¨∏Ïû•Í≥º ÏõêÎ¨∏ Ï†ÑÏ≤¥ÏóêÏÑú Í∞ÄÏû• Ïú†ÏÇ¨Ìïú Î∂ÄÎ∂Ñ Ï∞æÍ∏∞
        function findBestMatchSimilarity(sentence, originalText) {
            const cleanSentence = sentence.replace(/[^\wÍ∞Ä-Ìû£\s]/g, '').trim();
            if (cleanSentence.length < 5) return 0;
            
            // ÏõêÎ¨∏ÏùÑ Î¨∏Ïû• Îã®ÏúÑÎ°ú Î∂ÑÎ¶¨ÌïòÏó¨ Í∞ÅÍ∞ÅÍ≥º ÎπÑÍµê
            const originalSentences = originalText.split(/[.!?]/).filter(s => s.trim().length > 5);
            let maxSimilarity = 0;
            
            for (const origSentence of originalSentences) {
                const similarity = calculateSentenceSimilarity(cleanSentence, origSentence.trim());
                maxSimilarity = Math.max(maxSimilarity, similarity);
            }
            
            // Ïó∞ÏÜçÎêú Îã®Ïñ¥ Îß§Ïπ≠ÎèÑ ÌôïÏù∏
            const words = cleanSentence.split(/\s+/);
            for (const word of words) {
                if (word.length > 2 && originalText.includes(word)) {
                    maxSimilarity = Math.max(maxSimilarity, 40);
                }
            }
            
            return maxSimilarity;
        }

        // Îëê Î¨∏Ïû• Í∞ÑÏùò Ïú†ÏÇ¨ÎèÑ Í≥ÑÏÇ∞
        function calculateSentenceSimilarity(sentence1, sentence2) {
            const words1 = sentence1.split(/\s+/).filter(w => w.length > 1);
            const words2 = sentence2.split(/\s+/).filter(w => w.length > 1);
            
            if (words1.length === 0 || words2.length === 0) return 0;
            
            let matchCount = 0;
            for (const word1 of words1) {
                for (const word2 of words2) {
                    if (word1 === word2 || (word1.length > 2 && word2.includes(word1)) || (word2.length > 2 && word1.includes(word2))) {
                        matchCount++;
                        break;
                    }
                }
            }
            
            return (matchCount / Math.max(words1.length, words2.length)) * 100;
        }

        // ÌÖçÏä§Ìä∏ÏóêÏÑú Îã®Ïñ¥ Ï∂îÏ∂ú
        function extractWords(text) {
            return text.replace(/[^\wÍ∞Ä-Ìû£\s]/g, ' ')
                      .split(/\s+/)
                      .filter(word => word.length > 1)
                      .map(word => word.toLowerCase());
        }

        // ÌÖçÏä§Ìä∏ÏóêÏÑú Íµ¨Î¨∏ Ï∂îÏ∂ú (2-3 Îã®Ïñ¥ Ï°∞Ìï©)
        function extractPhrases(text) {
            const words = extractWords(text);
            const phrases = [];
            
            for (let i = 0; i < words.length - 1; i++) {
                phrases.push(words[i] + ' ' + words[i + 1]);
                if (i < words.length - 2) {
                    phrases.push(words[i] + ' ' + words[i + 1] + ' ' + words[i + 2]);
                }
            }
            
            return phrases;
        }

        // Îã®Ïñ¥ Î†àÎ≤® Ïú†ÏÇ¨ÎèÑ Í≥ÑÏÇ∞
        function calculateWordSimilarity(words1, words2) {
            const set1 = new Set(words1);
            const set2 = new Set(words2);
            const intersection = new Set([...set1].filter(x => set2.has(x)));
            const union = new Set([...set1, ...set2]);
            
            return union.size > 0 ? (intersection.size / union.size) * 100 : 0;
        }

        // Íµ¨Î¨∏ Î†àÎ≤® Ïú†ÏÇ¨ÎèÑ Í≥ÑÏÇ∞
        function calculatePhraseSimilarity(phrases1, phrases2) {
            const set1 = new Set(phrases1);
            const set2 = new Set(phrases2);
            const intersection = new Set([...set1].filter(x => set2.has(x)));
            const union = new Set([...set1, ...set2]);
            
            return union.size > 0 ? (intersection.size / union.size) * 100 : 0;
        }

        // Íµ¨Ï°∞Ï†Å Ïú†ÏÇ¨ÎèÑ Í≥ÑÏÇ∞
        function calculateStructureSimilarity(text1, text2) {
            const sentences1 = text1.split(/[.!?]/).filter(s => s.trim().length > 0);
            const sentences2 = text2.split(/[.!?]/).filter(s => s.trim().length > 0);
            
            const lengthDiff = Math.abs(sentences1.length - sentences2.length);
            const maxLength = Math.max(sentences1.length, sentences2.length);
            
            return maxLength > 0 ? Math.max(0, (1 - lengthDiff / maxLength) * 100) : 0;
        }
        
        // AI ÏÉùÏÑ± Í∏Ä Î≥µÏÇ¨ Ìï®Ïàò
        async function copyAIToClipboard() {
            const aiCopyBtn = document.getElementById('aiCopyBtn');
            const aiResultContent = document.getElementById('aiResultContent');
            
            if (!aiResultContent.textContent) {
                alert('Î≥µÏÇ¨Ìï† AI ÏÉùÏÑ± Í∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            try {
                // ÏµúÏã† Î∏åÎùºÏö∞Ï†ÄÏùò Clipboard API ÏÇ¨Ïö©
                await navigator.clipboard.writeText(aiResultContent.textContent);
                
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥ÄÍ≤Ω
                aiCopyBtn.textContent = '‚úÖ Î≥µÏÇ¨ÏôÑÎ£å!';
                aiCopyBtn.classList.add('copied');
                
                // 2Ï¥à ÌõÑ ÏõêÎûò ÏÉÅÌÉúÎ°ú Î≥µÏõê
                setTimeout(() => {
                    aiCopyBtn.textContent = 'üìã Î≥µÏÇ¨ÌïòÍ∏∞';
                    aiCopyBtn.classList.remove('copied');
                }, 2000);
                
            } catch (err) {
                // Clipboard APIÍ∞Ä ÏßÄÏõêÎêòÏßÄ ÏïäÎäî Í≤ΩÏö∞ ÎåÄÏ≤¥ Î∞©Î≤ï ÏÇ¨Ïö©
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = aiResultContent.textContent;
                    textArea.style.position = 'fixed';
                    textArea.style.top = '-9999px';
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    aiCopyBtn.textContent = '‚úÖ Î≥µÏÇ¨ÏôÑÎ£å!';
                    aiCopyBtn.classList.add('copied');
                    
                    setTimeout(() => {
                        aiCopyBtn.textContent = 'üìã Î≥µÏÇ¨ÌïòÍ∏∞';
                        aiCopyBtn.classList.remove('copied');
                    }, 2000);
                    
                } catch (fallbackErr) {
                    console.error('Î≥µÏÇ¨ Ïã§Ìå®:', fallbackErr);
                    alert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÏàòÎèôÏúºÎ°ú ÌÖçÏä§Ìä∏Î•º ÏÑ†ÌÉùÌïòÏó¨ Î≥µÏÇ¨Ìï¥Ï£ºÏÑ∏Ïöî.');
                }
            }
        }

        // ÎëêÎ≤àÏß∏ AI ÏÉùÏÑ± Í∏Ä Î≥µÏÇ¨ Ìï®Ïàò
        async function copyAI2ToClipboard() {
            const aiCopyBtn2 = document.getElementById('aiCopyBtn2');
            const aiResultContent2 = document.getElementById('aiResultContent2');
            
            if (!aiResultContent2.textContent) {
                alert('Î≥µÏÇ¨Ìï† AI ÏÉùÏÑ± Í∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            try {
                // ÏµúÏã† Î∏åÎùºÏö∞Ï†ÄÏùò Clipboard API ÏÇ¨Ïö©
                await navigator.clipboard.writeText(aiResultContent2.textContent);
                
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥ÄÍ≤Ω
                aiCopyBtn2.textContent = '‚úÖ Î≥µÏÇ¨ÏôÑÎ£å!';
                aiCopyBtn2.classList.add('copied');
                
                // 2Ï¥à ÌõÑ ÏõêÎûò ÏÉÅÌÉúÎ°ú Î≥µÏõê
                setTimeout(() => {
                    aiCopyBtn2.textContent = 'üìã Î≥µÏÇ¨ÌïòÍ∏∞';
                    aiCopyBtn2.classList.remove('copied');
                }, 2000);
                
            } catch (err) {
                // Clipboard APIÍ∞Ä ÏßÄÏõêÎêòÏßÄ ÏïäÎäî Í≤ΩÏö∞ ÎåÄÏ≤¥ Î∞©Î≤ï ÏÇ¨Ïö©
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = aiResultContent2.textContent;
                    textArea.style.position = 'fixed';
                    textArea.style.top = '-9999px';
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    aiCopyBtn2.textContent = '‚úÖ Î≥µÏÇ¨ÏôÑÎ£å!';
                    aiCopyBtn2.classList.add('copied');
                    
                    setTimeout(() => {
                        aiCopyBtn2.textContent = 'üìã Î≥µÏÇ¨ÌïòÍ∏∞';
                        aiCopyBtn2.classList.remove('copied');
                    }, 2000);
                    
                } catch (fallbackErr) {
                    console.error('Î≥µÏÇ¨ Ïã§Ìå®:', fallbackErr);
                    alert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÏàòÎèôÏúºÎ°ú ÌÖçÏä§Ìä∏Î•º ÏÑ†ÌÉùÌïòÏó¨ Î≥µÏÇ¨Ìï¥Ï£ºÏÑ∏Ïöî.');
                }
            }
        }

        // ÎëêÎ≤àÏß∏ AI ÏÉùÏÑ± Í∏ÄÍ≥º ÏõêÎ¨∏ ÎπÑÍµê Ìï®Ïàò
        function compareTexts2() {
            const resultContent = document.getElementById('resultContent');
            const aiResultContent2 = document.getElementById('aiResultContent2');
            const comparisonResult = document.getElementById('comparisonResult');
            const comparisonContent = document.getElementById('comparisonContent');
            
            if (!resultContent.textContent || !aiResultContent2.textContent) {
                alert('Ïä§ÌÅ¨Îû©Îêú Í∏ÄÍ≥º AI ÏÉùÏÑ± Í∏ÄÏù¥ Î™®Îëê ÏûàÏñ¥Ïïº ÎπÑÍµêÌï† Ïàò ÏûàÏäµÎãàÎã§.');
                return;
            }
            
            console.log('[DEBUG] ÎëêÎ≤àÏß∏ Í∏Ä Ï†ÑÏ≤¥ Î¨∏Îß• Í∏∞Î∞ò ÎπÑÍµê ÏãúÏûë');
            
            // ÏõêÎ¨∏Í≥º AI ÏÉùÏÑ±Í∏Ä Ï†ÑÏ≤¥ ÌÖçÏä§Ìä∏
            const originalText = resultContent.textContent.trim();
            const aiText = aiResultContent2.textContent
                .replace(/\n\n‚Äª.*$/, '') // Î©îÏãúÏßÄ Î∂ÄÎ∂Ñ Ï†úÍ±∞
                .trim();
            
            // AI ÌÖçÏä§Ìä∏ÏóêÏÑú ÏõêÎ¨∏Í≥º Ïú†ÏÇ¨Ìïú Î∂ÄÎ∂ÑÏùÑ Ï∞æÏïÑÏÑú Îπ®Í∞ÑÏÉâÏúºÎ°ú ÌëúÏãú
            const highlightedAiText = highlightSimilarParts(originalText, aiText);
            
            // Ï†ÑÏ≤¥ Ïú†ÏÇ¨ÎèÑ Í≥ÑÏÇ∞
            const similarity = calculateAdvancedSimilarity(originalText, aiText);
            
            // ÎπÑÍµê Í≤∞Í≥º HTML ÏÉùÏÑ±
            let comparisonHTML = `
                <div style="margin-bottom: 20px; text-align: center;">
                    <p><strong>ÏõêÎ¨∏:</strong> ${originalText.length}Ïûê</p>
                    <p><strong>ÎëêÎ≤àÏß∏ AI ÏÉùÏÑ±Í∏Ä:</strong> ${aiText.length}Ïûê</p>
                    <p><strong>Ï†ÑÏ≤¥ Î¨∏Îß• Ïú†ÏÇ¨ÎèÑ:</strong> ${similarity.toFixed(1)}%</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #333; margin-bottom: 10px;">üìÑ ÏõêÎ¨∏</h4>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; line-height: 1.8; border-left: 4px solid #6c757d;">
                        ${formatTextWithLineBreaks(originalText)}
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #333; margin-bottom: 10px;">‚ú® ÎëêÎ≤àÏß∏ AI ÏÉùÏÑ±Í∏Ä (Ïú†ÏÇ¨Ìïú Î∂ÄÎ∂ÑÏùÄ <span style="color: red;">Îπ®Í∞ÑÏÉâ</span>ÏúºÎ°ú ÌëúÏãú)</h4>
                    <div style="background: #f0f8ff; padding: 20px; border-radius: 8px; line-height: 1.8; border-left: 4px solid #667eea;">
                        ${highlightedAiText}
                    </div>
                </div>
            `;
            
            comparisonContent.innerHTML = comparisonHTML;
            comparisonResult.style.display = 'block';
            
            // Ïä§ÌÅ¨Î°§Î°ú ÎπÑÍµê Í≤∞Í≥ºÍπåÏßÄ Ïù¥Îèô
            comparisonResult.scrollIntoView({ behavior: 'smooth' });
            
            console.log(`[DEBUG] ÎëêÎ≤àÏß∏ Í∏Ä ÎπÑÍµê ÏôÑÎ£å - Ïú†ÏÇ¨ÎèÑ: ${similarity.toFixed(1)}%`);
        }

        // Ï≤´Î≤àÏß∏ ÏÉùÏÑ±Îêú Í∏ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú ClaudeÎ°ú ÏÉàÎ°úÏö¥ Í∏Ä ÏÉùÏÑ±
        async function generateFromFirstClaude() {
            const aiResultContent = document.getElementById('aiResultContent');
            const aiPrompt = document.getElementById('aiPrompt').value.trim();
            const aiResultContent2 = document.getElementById('aiResultContent2');
            const aiResult2 = document.getElementById('aiResult2');
            const generateFromFirstClaudeBtn = document.getElementById('generateFromFirstClaudeBtn');
            const compareBtn2 = document.getElementById('compareBtn2');
            
            if (!aiResultContent.textContent) {
                alert('Î®ºÏ†Ä Ï≤´Î≤àÏß∏ AI ÏÉùÏÑ± Í∏ÄÏù¥ ÏûàÏñ¥Ïïº Ìï©ÎãàÎã§.');
                return;
            }
            
            if (!aiPrompt) {
                alert('AI ÌîÑÎ°¨ÌîÑÌä∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // Î≤ÑÌäº ÏÉÅÌÉú Î≥ÄÍ≤Ω
            generateFromFirstClaudeBtn.disabled = true;
            generateFromFirstClaudeBtn.innerHTML = 'üîÑ ClaudeÍ∞Ä Í∏ÄÏùÑ ÏÉùÏÑ±ÌïòÎäî Ï§ë...';
            
            // ÎëêÎ≤àÏß∏ AI Í≤∞Í≥º ÏÑπÏÖò ÌëúÏãú
            aiResult2.style.display = 'block';
            aiResultContent2.textContent = 'ClaudeÍ∞Ä Ï≤´Î≤àÏß∏ ÏÉùÏÑ±Îêú Í∏ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú ÏÉàÎ°úÏö¥ Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ ÏÉùÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§...';
            
            try {
                const keyword = document.getElementById('keyword').value.trim();
                const firstGeneratedContent = aiResultContent.textContent
                    .replace(/\n\n‚Äª.*$/, '') // Î©îÏãúÏßÄ Î∂ÄÎ∂Ñ Ï†úÍ±∞
                    .trim();
                
                console.log('[DEBUG] Ï≤´Î≤àÏß∏ ÏÉùÏÑ±Îêú Í∏Ä Í∏∞Î∞ò Claude ÏÉùÏÑ± ÏãúÏûë');
                
                const response = await fetch('/api/generate-ai-from-scraped', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        scrapedContent: firstGeneratedContent,
                        aiPrompt: aiPrompt,
                        keyword: keyword,
                        useFirstContent: true  // Ï≤´Î≤àÏß∏ ÏÉùÏÑ±Îêú Í∏Ä Í∏∞Î∞òÏûÑÏùÑ ÌëúÏãú
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const formattedContent = formatTextWithLineBreaks(data.content);
                    aiResultContent2.innerHTML = formattedContent;
                    
                    if (data.message) {
                        aiResultContent2.innerHTML += `<br><br>‚Äª ${data.message}`;
                    }
                    
                    // ÎπÑÍµê Î≤ÑÌäº ÌëúÏãú
                    compareBtn2.style.display = 'block';
                    
                    console.log('[DEBUG] Ï≤´Î≤àÏß∏ ÏÉùÏÑ±Îêú Í∏Ä Í∏∞Î∞ò Claude ÏÉùÏÑ± ÏôÑÎ£å');
                } else {
                    aiResultContent2.textContent = `Claude Í∏Ä ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ${data.error}`;
                    console.error('[ERROR] Claude ÏÉùÏÑ± Ïã§Ìå®:', data.error);
                }
                
            } catch (error) {
                console.error('[ERROR] Claude ÏÉùÏÑ± Ï§ë Ïò§Î•ò:', error);
                aiResultContent2.textContent = 'Claude Í∏Ä ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. ÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
            } finally {
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÏõê
                generateFromFirstClaudeBtn.disabled = false;
                generateFromFirstClaudeBtn.innerHTML = 'ü§ñ Ï≤´Î≤àÏß∏ ÏÉùÏÑ±ÎêúÍ∏ÄÎ°ú Claude Í∏ÄÏûëÏÑ±ÌïòÍ∏∞';
            }
        }

        // Ï≤´Î≤àÏß∏ ÏÉùÏÑ±Îêú Í∏ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú GeminiÎ°ú ÏÉàÎ°úÏö¥ Í∏Ä ÏÉùÏÑ±
        async function generateFromFirstGemini() {
            const aiResultContent = document.getElementById('aiResultContent');
            const aiPrompt = document.getElementById('aiPrompt').value.trim();
            const aiResultContent2 = document.getElementById('aiResultContent2');
            const aiResult2 = document.getElementById('aiResult2');
            const generateFromFirstGeminiBtn = document.getElementById('generateFromFirstGeminiBtn');
            const compareBtn2 = document.getElementById('compareBtn2');
            
            if (!aiResultContent.textContent) {
                alert('Î®ºÏ†Ä Ï≤´Î≤àÏß∏ AI ÏÉùÏÑ± Í∏ÄÏù¥ ÏûàÏñ¥Ïïº Ìï©ÎãàÎã§.');
                return;
            }
            
            if (!aiPrompt) {
                alert('AI ÌîÑÎ°¨ÌîÑÌä∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // Î≤ÑÌäº ÏÉÅÌÉú Î≥ÄÍ≤Ω
            generateFromFirstGeminiBtn.disabled = true;
            generateFromFirstGeminiBtn.innerHTML = 'üîÑ GeminiÍ∞Ä Í∏ÄÏùÑ ÏÉùÏÑ±ÌïòÎäî Ï§ë...';
            
            // ÎëêÎ≤àÏß∏ AI Í≤∞Í≥º ÏÑπÏÖò ÌëúÏãú
            aiResult2.style.display = 'block';
            aiResultContent2.textContent = 'GeminiÍ∞Ä Ï≤´Î≤àÏß∏ ÏÉùÏÑ±Îêú Í∏ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú ÏÉàÎ°úÏö¥ Î∏îÎ°úÍ∑∏ Í∏ÄÏùÑ ÏÉùÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§...';
            
            try {
                const keyword = document.getElementById('keyword').value.trim();
                const firstGeneratedContent = aiResultContent.textContent
                    .replace(/\n\n‚Äª.*$/, '') // Î©îÏãúÏßÄ Î∂ÄÎ∂Ñ Ï†úÍ±∞
                    .trim();
                
                console.log('[DEBUG] Ï≤´Î≤àÏß∏ ÏÉùÏÑ±Îêú Í∏Ä Í∏∞Î∞ò Gemini ÏÉùÏÑ± ÏãúÏûë');
                
                const response = await fetch('/api/generate-gemini-from-scraped', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        scrapedContent: firstGeneratedContent,
                        aiPrompt: aiPrompt,
                        keyword: keyword,
                        useFirstContent: true  // Ï≤´Î≤àÏß∏ ÏÉùÏÑ±Îêú Í∏Ä Í∏∞Î∞òÏûÑÏùÑ ÌëúÏãú
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const formattedContent = formatTextWithLineBreaks(data.content);
                    aiResultContent2.innerHTML = formattedContent;
                    
                    if (data.message) {
                        aiResultContent2.innerHTML += `<br><br>‚Äª ${data.message}`;
                    }
                    
                    // ÎπÑÍµê Î≤ÑÌäº ÌëúÏãú
                    compareBtn2.style.display = 'block';
                    
                    console.log('[DEBUG] Ï≤´Î≤àÏß∏ ÏÉùÏÑ±Îêú Í∏Ä Í∏∞Î∞ò Gemini ÏÉùÏÑ± ÏôÑÎ£å');
                } else {
                    aiResultContent2.textContent = `Gemini Í∏Ä ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ${data.error}`;
                    console.error('[ERROR] Gemini ÏÉùÏÑ± Ïã§Ìå®:', data.error);
                }
                
            } catch (error) {
                console.error('[ERROR] Gemini ÏÉùÏÑ± Ï§ë Ïò§Î•ò:', error);
                aiResultContent2.textContent = 'Gemini Í∏Ä ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. ÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
            } finally {
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÏõê
                generateFromFirstGeminiBtn.disabled = false;
                generateFromFirstGeminiBtn.innerHTML = 'üíé Ï≤´Î≤àÏß∏ ÏÉùÏÑ±ÎêúÍ∏ÄÎ°ú Gemini Í∏ÄÏûëÏÑ±ÌïòÍ∏∞';
            }
        }

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.getElementById('loginModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeLoginModal();
            }
        });

        document.getElementById('settingsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSettingsModal();
            }
        });

        document.getElementById('keywordChoiceModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeKeywordChoiceModal();
            }
        });


        // ÌÇ§ÏõåÎìúÎ∞úÍµ¥ ÌôîÎ©¥ Í¥ÄÎ†® Ìï®ÏàòÎì§
        function showKeywordDiscovery() {
            if (!currentUser) {
                alert('Î°úÍ∑∏Ïù∏ÏùÑ Ìïú ÌõÑÏóê ÏÇ¨Ïö©ÌïòÏã≠ÏãúÏò§');
                return;
            }
            
            const mainContainer = document.querySelector('.container');
            const keywordDiscoveryPage = document.getElementById('keywordDiscoveryPage');
            
            mainContainer.style.display = 'none';
            keywordDiscoveryPage.style.display = 'block';
            
            // Ïä§ÌÅ¨Î°§ÏùÑ Îß® ÏúÑÎ°ú
            window.scrollTo(0, 0);
        }

        async function discoverNewKeywords() {
            if (!currentUser) {
                alert('Î°úÍ∑∏Ïù∏ÏùÑ Ìïú ÌõÑÏóê ÏÇ¨Ïö©ÌïòÏã≠ÏãúÏò§');
                return;
            }

            const newKeywordBtn = document.querySelector('.new-keyword-btn');
            const discoveryResults = document.getElementById('discoveryResults');
            
            // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî Î∞è Î°úÎî© ÏÉÅÌÉú
            newKeywordBtn.disabled = true;
            newKeywordBtn.innerHTML = 'üîÑ Ïã†Í∑úÌÇ§ÏõåÎìú Î∞úÍµ¥ Ï§ë...';
            
            try {
                // Ïã†Í∑ú ÌÇ§ÏõåÎìú Î∞úÍµ¥ API Ìò∏Ï∂ú
                const [trendingResponse, emergingResponse, seasonalResponse] = await Promise.all([
                    fetch('/api/new-keywords/trending', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({})
                    }),
                    fetch('/api/new-keywords/emerging', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({})
                    }),
                    fetch('/api/new-keywords/seasonal', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({})
                    })
                ]);

                const [trendingData, emergingData, seasonalData] = await Promise.all([
                    trendingResponse.json(),
                    emergingResponse.json(),
                    seasonalResponse.json()
                ]);

                // Ïã†Í∑úÌÇ§ÏõåÎìú Í≤∞Í≥º ÌëúÏãú
                displayNewKeywordResults(trendingData, emergingData, seasonalData);
                discoveryResults.style.display = 'block';
                discoveryResults.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error('Ïã†Í∑úÌÇ§ÏõåÎìú Î∞úÍµ¥ Ïò§Î•ò:', error);
                alert('Ïã†Í∑úÌÇ§ÏõåÎìú Î∞úÍµ¥ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            } finally {
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÏõê
                newKeywordBtn.disabled = false;
                newKeywordBtn.innerHTML = 'üÜï Ïã†Í∑úÌÇ§ÏõåÎìú Í≤ÄÏÉâ';
            }
        }

        function displayNewKeywordResults(trendingData, emergingData, seasonalData) {
            // Í∏∞Î≥∏ Î∂ÑÏÑùÏóê Ïã†Í∑úÌÇ§ÏõåÎìú Í∞úÏöî ÌëúÏãú
            const basicAnalysis = document.getElementById('basicAnalysis');
            basicAnalysis.innerHTML = `
                <div style="padding: 20px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; border-radius: 12px; text-align: center;">
                    <h3 style="margin: 0 0 15px 0; font-size: 1.4em;">üÜï Ïã†Í∑úÌÇ§ÏõåÎìú Î∞úÍµ¥ Í≤∞Í≥º</h3>
                    <p style="margin: 0; font-size: 1.1em; opacity: 0.9;">ÏµúÏã† Ìä∏Î†åÎìúÏôÄ Í∏âÏÉÅÏäπ ÌÇ§ÏõåÎìúÎ•º Î∞úÍµ¥ÌñàÏäµÎãàÎã§</p>
                    <p style="margin: 10px 0 0 0; font-size: 0.9em; opacity: 0.8;">Ï¥ù ${(trendingData.keywords?.length || 0) + (emergingData.keywords?.length || 0) + (seasonalData.keywords?.length || 0)}Í∞úÏùò Ïã†Í∑ú ÌÇ§ÏõåÎìúÎ•º Î∞úÍ≤¨ÌñàÏäµÎãàÎã§</p>
                </div>
            `;

            // Ïó∞Í¥Ä ÌÇ§ÏõåÎìú ‚Üí Ìä∏Î†åÎî© ÌÇ§ÏõåÎìú
            const relatedKeywords = document.getElementById('relatedKeywords');
            if (trendingData.success && trendingData.keywords) {
                relatedKeywords.innerHTML = trendingData.keywords.slice(0, 15).map(kw => `
                    <div style="display: inline-block; margin: 5px; padding: 10px 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 25px; font-size: 14px; font-weight: 600; cursor: pointer;" onclick="selectNewKeyword('${kw.keyword}')">
                        üî• ${kw.keyword} <small>(+${kw.growth || 'Ïã†Í∑ú'})</small>
                    </div>
                `).join('');
                // Ï†úÎ™© Î≥ÄÍ≤Ω
                document.querySelector('#relatedKeywords').parentElement.querySelector('h4').innerHTML = 'üî• Ìä∏Î†åÎî© ÌÇ§ÏõåÎìú';
            }

            // Î°±ÌÖåÏùº ÌÇ§ÏõåÎìú ‚Üí Í∏âÏÉÅÏäπ ÌÇ§ÏõåÎìú
            const longTailKeywords = document.getElementById('longTailKeywords');
            if (emergingData.success && emergingData.keywords) {
                longTailKeywords.innerHTML = emergingData.keywords.slice(0, 12).map(kw => `
                    <div style="display: inline-block; margin: 5px; padding: 10px 15px; background: linear-gradient(135deg, #ff9a56 0%, #ff6b35 100%); color: white; border-radius: 25px; font-size: 14px; font-weight: 600; cursor: pointer;" onclick="selectNewKeyword('${kw.keyword}')">
                        üìà ${kw.keyword} <small>(${kw.searchVolume || 'N/A'})</small>
                    </div>
                `).join('');
                // Ï†úÎ™© Î≥ÄÍ≤Ω
                document.querySelector('#longTailKeywords').parentElement.querySelector('h4').innerHTML = 'üìà Í∏âÏÉÅÏäπ ÌÇ§ÏõåÎìú';
            }

            // Í∏âÏÉÅÏäπ ÌÇ§ÏõåÎìú ‚Üí Í≥ÑÏ†àÏÑ± ÌÇ§ÏõåÎìú
            const trendingKeywords = document.getElementById('trendingKeywords');
            if (seasonalData.success && seasonalData.keywords) {
                trendingKeywords.innerHTML = seasonalData.keywords.slice(0, 10).map(kw => `
                    <div style="display: inline-block; margin: 5px; padding: 10px 15px; background: linear-gradient(135deg, #26d0ce 0%, #1a9bf0 100%); color: white; border-radius: 25px; font-size: 14px; font-weight: 600; cursor: pointer;" onclick="selectNewKeyword('${kw.keyword}')">
                        üåü ${kw.keyword} <small>(${kw.season || 'ÏãúÏ¶å'})</small>
                    </div>
                `).join('');
                // Ï†úÎ™© Î≥ÄÍ≤Ω
                document.querySelector('#trendingKeywords').parentElement.querySelector('h4').innerHTML = 'üåü Í≥ÑÏ†àÏÑ± ÌÇ§ÏõåÎìú';
            }
        }

        function selectNewKeyword(keyword) {
            // ÏÑ†ÌÉùÎêú ÌÇ§ÏõåÎìúÎ•º Ï†ÄÏû•ÌïòÍ≥† Î™®Îã¨Ï∞Ω ÌëúÏãú (Ïã†Í∑úÌÇ§ÏõåÎìúÎèÑ ÎèôÏùºÌïú Î™®Îã¨ ÏÇ¨Ïö©)
            selectedKeywordForChoice = keyword;
            document.getElementById('selectedKeywordText').textContent = keyword;
            document.getElementById('keywordChoiceModal').style.display = 'block';
        }

        function hideKeywordDiscovery() {
            const mainContainer = document.querySelector('.container');
            const keywordDiscoveryPage = document.getElementById('keywordDiscoveryPage');
            
            keywordDiscoveryPage.style.display = 'none';
            mainContainer.style.display = 'block';
            
            // Ïä§ÌÅ¨Î°§ÏùÑ Îß® ÏúÑÎ°ú
            window.scrollTo(0, 0);
        }

        async function startKeywordDiscovery() {
            const keywordInput = document.getElementById('keywordDiscoveryInput');
            const keyword = keywordInput.value.trim();
            
            if (!keyword) {
                alert('ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const searchBtn = document.querySelector('.search-btn');
            const discoveryResults = document.getElementById('discoveryResults');
            
            // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî Î∞è Î°úÎî© ÏÉÅÌÉú
            searchBtn.disabled = true;
            searchBtn.innerHTML = 'üîÑ Î∞úÍµ¥ Ï§ë...';
            
            try {
                // Í∏∞Î≥∏ Î∂ÑÏÑù, Ïó∞Í¥Ä ÌÇ§ÏõåÎìú, Î°±ÌÖåÏùº, Ìä∏Î†åÎìú Î™®Îëê ÌïúÎ≤àÏóê ÏöîÏ≤≠
                const [competitionResponse, relatedResponse, trendsResponse] = await Promise.all([
                    fetch('/api/keyword-research/competition', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ keyword })
                    }),
                    fetch('/api/keyword-research/related', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ keyword })
                    }),
                    fetch('/api/keyword-research/trends', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ keyword })
                    })
                ]);

                const [competitionData, relatedData, trendsData] = await Promise.all([
                    competitionResponse.json(),
                    relatedResponse.json(),
                    trendsResponse.json()
                ]);

                // Í≤∞Í≥º ÌëúÏãú
                displayDiscoveryResults(competitionData, relatedData, trendsData);
                discoveryResults.style.display = 'block';
                discoveryResults.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error('ÌÇ§ÏõåÎìú Î∞úÍµ¥ Ïò§Î•ò:', error);
                alert('ÌÇ§ÏõåÎìú Î∞úÍµ¥ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            } finally {
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÏõê
                searchBtn.disabled = false;
                searchBtn.innerHTML = 'üîç ÌÇ§ÏõåÎìú Î∞úÍµ¥ ÏãúÏûë';
            }
        }

        function displayDiscoveryResults(competitionData, relatedData, trendsData) {
            // Í∏∞Î≥∏ Î∂ÑÏÑù ÌëúÏãú
            const basicAnalysis = document.getElementById('basicAnalysis');
            if (competitionData.success) {
                const analysis = competitionData.analysis;
                basicAnalysis.innerHTML = `
                    <div style="padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #4CAF50;">
                        <p><strong>Í≤ÄÏÉâÎüâ:</strong> ${analysis.searchVolume?.toLocaleString() || 'N/A'}</p>
                        <p><strong>Í≤ΩÏüÅÎèÑ:</strong> <span class="keyword-competition ${analysis.competition}">${getCompetitionText(analysis.competition)}</span></p>
                        <p><strong>KEI Ï†êÏàò:</strong> ${analysis.keiScore || 'N/A'}</p>
                        <p><strong>ÎÇúÏù¥ÎèÑ:</strong> ${analysis.difficulty || 'N/A'}</p>
                        <p><strong>Ï∂îÏ≤úÎèÑ:</strong> ${analysis.recommendation || 'N/A'}</p>
                    </div>
                `;
            }

            // Ïó∞Í¥Ä ÌÇ§ÏõåÎìú ÌëúÏãú
            const relatedKeywords = document.getElementById('relatedKeywords');
            if (relatedData.success && relatedData.relatedKeywords) {
                relatedKeywords.innerHTML = relatedData.relatedKeywords.slice(0, 10).map(kw => `
                    <div style="display: inline-block; margin: 5px; padding: 8px 12px; background: #e3f2fd; border-radius: 20px; font-size: 14px; cursor: pointer;" onclick="selectKeyword('${kw.keyword}')">
                        ${kw.keyword} <small>(${kw.searchVolume})</small>
                    </div>
                `).join('');
            }

            // Î°±ÌÖåÏùº ÌÇ§ÏõåÎìú ÌëúÏãú
            const longTailKeywords = document.getElementById('longTailKeywords');
            if (relatedData.success && relatedData.longTailKeywords) {
                longTailKeywords.innerHTML = relatedData.longTailKeywords.slice(0, 15).map(kw => `
                    <div style="display: inline-block; margin: 5px; padding: 8px 12px; background: #f3e5f5; border-radius: 20px; font-size: 14px; cursor: pointer;" onclick="selectKeyword('${kw.keyword}')">
                        ${kw.keyword} <small>(${kw.searchVolume})</small>
                    </div>
                `).join('');
            }

            // Í∏âÏÉÅÏäπ ÌÇ§ÏõåÎìú ÌëúÏãú
            const trendingKeywords = document.getElementById('trendingKeywords');
            if (trendsData.success && trendsData.trends) {
                trendingKeywords.innerHTML = trendsData.trends.trendingKeywords?.slice(0, 10).map(kw => `
                    <div style="display: inline-block; margin: 5px; padding: 8px 12px; background: #fff3e0; border-radius: 20px; font-size: 14px; cursor: pointer;" onclick="selectKeyword('${kw.keyword}')">
                        ${kw.keyword} <small>(+${kw.growthRate}%)</small>
                    </div>
                `).join('') || '<p>Í∏âÏÉÅÏäπ ÌÇ§ÏõåÎìú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
            }
        }
    </script>
</body>
</html>